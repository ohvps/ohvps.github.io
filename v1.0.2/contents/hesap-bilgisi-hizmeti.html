<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7.	Hesap Bilgisi Hizmeti | (ÖHVPS) API İLKE VE KURALLARI</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.4cb6486d.css" as="style"><link rel="preload" href="/assets/js/app.235406e1.js" as="script"><link rel="preload" href="/assets/js/9.97cddfb1.js" as="script"><link rel="preload" href="/assets/js/2.60a0bf64.js" as="script"><link rel="preload" href="/assets/js/6.f1be765e.js" as="script"><link rel="prefetch" href="/assets/js/10.75514e3a.js"><link rel="prefetch" href="/assets/js/11.cfb7c8c6.js"><link rel="prefetch" href="/assets/js/12.993b80b5.js"><link rel="prefetch" href="/assets/js/13.8ea4e967.js"><link rel="prefetch" href="/assets/js/14.09f6db88.js"><link rel="prefetch" href="/assets/js/15.3da2d5ee.js"><link rel="prefetch" href="/assets/js/16.ea67553e.js"><link rel="prefetch" href="/assets/js/17.33ab88b0.js"><link rel="prefetch" href="/assets/js/18.38ef03f2.js"><link rel="prefetch" href="/assets/js/19.1e0c587d.js"><link rel="prefetch" href="/assets/js/20.7c0852ca.js"><link rel="prefetch" href="/assets/js/21.d323c49c.js"><link rel="prefetch" href="/assets/js/22.8afeb7ac.js"><link rel="prefetch" href="/assets/js/23.26385ab4.js"><link rel="prefetch" href="/assets/js/24.a813aa59.js"><link rel="prefetch" href="/assets/js/25.87dda73d.js"><link rel="prefetch" href="/assets/js/26.0c271c81.js"><link rel="prefetch" href="/assets/js/27.4e9b6558.js"><link rel="prefetch" href="/assets/js/28.21903064.js"><link rel="prefetch" href="/assets/js/29.323cd93f.js"><link rel="prefetch" href="/assets/js/3.6a6cd909.js"><link rel="prefetch" href="/assets/js/30.f59bda6b.js"><link rel="prefetch" href="/assets/js/4.8b8e8c76.js"><link rel="prefetch" href="/assets/js/5.3d70b2d6.js"><link rel="prefetch" href="/assets/js/7.f79574a7.js"><link rel="prefetch" href="/assets/js/8.661467e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4cb6486d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/TCMB_logo.svg.png" alt="(ÖHVPS) API İLKE VE KURALLARI" class="logo"> <span class="site-name can-hide">(ÖHVPS) API İLKE VE KURALLARI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/v1.0.2/contents/tanim-ve-kisitlamalar" class="sidebar-heading clickable open"><span>SÜRÜM 1.0.2 </span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/v1.0.2/contents/tanim-ve-kisitlamalar.html" class="sidebar-link">1. Tanımlar ve Kısıtlamalar</a></li><li><a href="/v1.0.2/contents/kapsam-ve-dayanak.html" class="sidebar-link">2. Kapsam ve Dayanak</a></li><li><a href="/v1.0.2/contents/temel-prensipler.html" class="sidebar-link">3. Temel Prensipler</a></li><li><a href="/v1.0.2/contents/riza-durumlari.html" class="sidebar-link">4. Rıza Durumları</a></li><li><a href="/v1.0.2/contents/gkd.html" class="sidebar-link">5. Güçlü Kimlik Doğrulama</a></li><li><a href="/v1.0.2/contents/odeme-emri-baslatma-hizmeti.html" class="sidebar-link">6. Ödeme Emri Başlatma Hizmeti</a></li><li><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html" aria-current="page" class="active sidebar-link">7. Hesap Bilgisi Hizmeti</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#genel-bilgiler" class="sidebar-link">Genel Bilgiler</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#hesap-bilgisi-hizmeti-icin-erisim-adresleri" class="sidebar-link">Hesap Bilgisi Hizmeti İçin Erişim Adresleri</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#adim-0-ohk-nın-hesap-bilgilerine-erisim-icin-talepte-bulunması" class="sidebar-link">ADIM 0: ÖHK'nın hesap bilgilerine erişim için talepte bulunması:</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-1-adim-1-hesap-bilgisi-rızasının-hazırlanması" class="sidebar-link">7.1 ADIM 1: Hesap Bilgisi Rızasının Hazırlanması</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#izinler" class="sidebar-link">İzinler</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-2-adim-2-hesap-bilgisi-hizmeti-rızasının-tesisi" class="sidebar-link">7.2 ADIM 2: Hesap Bilgisi Hizmeti Rızasının Tesisi</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-3-adim-2-1-hesap-bilgisi-rızasının-sorgulanması-istege-baglı" class="sidebar-link">7.3 ADIM 2.1: Hesap Bilgisi Rızasının Sorgulanması (İsteğe Bağlı)</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-4-adim-2-2-hesap-bilgisi-rızasının-iptali" class="sidebar-link">7.4 ADIM 2.2: Hesap Bilgisi Rızasının İptali</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-5-adim-3-hesap-bilgilerinin-alınması" class="sidebar-link">7.5 ADIM 3: Hesap Bilgilerinin Alınması</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-6-adim-3-1-ve-3-2-hesap-bilgilerinin-sorgulanması" class="sidebar-link">7.6 ADIM 3.1 ve 3.2: Hesap Bilgilerinin Sorgulanması</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-7-adim-3-3-ve-3-4-hesap-bakiyesinin-sorgulanması" class="sidebar-link">7.7 ADIM 3.3 ve 3.4: Hesap Bakiyesinin Sorgulanması</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-8-adim-3-5-ve-3-6-islemlerin-sorgulanması" class="sidebar-link">7.8 ADIM 3.5 ve 3.6: İşlemlerin Sorgulanması</a></li><li class="sidebar-sub-header"><a href="/v1.0.2/contents/hesap-bilgisi-hizmeti.html#_7-9healthcheck-api" class="sidebar-link">7.9	Healthcheck API</a></li></ul></li><li><a href="/v1.0.2/contents/hhs-yos-api.html" class="sidebar-link">8. HHS ve YÖS API</a></li><li><a href="/v1.0.2/contents/erisim-belirteci.html" class="sidebar-link">9. Erişim Belirteci API</a></li><li><a href="/v1.0.2/contents/ekler.html" class="sidebar-link">10. Ekler</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/v1.0.1/contents/tanim-ve-kisitlamalar" class="sidebar-heading clickable"><span>SÜRÜM 1.0.1</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/surum-yonetimi.html" class="sidebar-link">Sürüm Yönetimi</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_7-hesap-bilgisi-hizmeti"><a href="#_7-hesap-bilgisi-hizmeti" class="header-anchor">#</a> 7.	Hesap Bilgisi Hizmeti </h1> <h2 id="genel-bilgiler"><a href="#genel-bilgiler" class="header-anchor">#</a> Genel Bilgiler</h2> <p>Hesap bilgisi sorgulama için HBHS tarafından müşteri rızası tesisinin HHS tamamlanmış olması gerekir. Müşteri rızası tesisi tamamlandıktan sonra, HBHS sorgulamak istediği hesaba ait verileri ilgili erişim adresi üzerinden sorgular.</p> <img src="/assets/img/HesapBilgisiHizmetiUstDuzeyAkisi.3e59c78c.png" width="50%"> <p>Şekil 10: Hesap Bilgisi Hizmeti Üst Düzey Akışı</p> <p>Şekil-10’da sunulan hesap bilgisi hizmeti 5 temel akıştan oluşur:</p> <p><strong>0.	Müşterinin hesap bilgilerine erişim için talepte bulunması:</strong> ÖHK ÖBHS mobil uygulama ya da web sitesinden hesap bilgilerine erişim işlemini başlatır.</p> <p><strong>1.	Hesap Bilgisi müşteri rızasının hazırlanması:</strong></p> <p>HBHS, “hesap bilgilerine erişim” için müşteri rızası tesisi amacıyla HHS’deki hesap bilgisi rızası erişim adresine bir POST isteğinde bulunur ve bir hesap bilgisi rızası nesnesi oluşturur. HHS hesap bilgisi rızası nesnesi için biricik tanımlayacı döner (RızaNo). Hesap bilgisi rızası, müşterinin HBHS’nin hesap bilgilerine erişim izin verdiği alanları içerir:</p> <ul><li>İzinler - erişim için izin verilen veri kümelerinin listesi.</li> <li>Erişimin Geçerli Olduğu Son Tarih - HBHS'nin müşterinin hesap bilgilerine erişebileceği isteğe bağlı seçilebilen son tarih.</li> <li>İşlem Sorgulama Başlangıç Zamanı – Müşteri rızasının tesisinden itibaren geriye dönük olarak HBHS’nin hesap bilgilerine erişebileceği süreyi</li> <li>İşlem Sorgulama Bitiş Zamanı - Müşteri rızasının tesisinden itibaren ileriye dönük olarak HBHS’nin hesap bilgilerine erişebileceği süreyi</li></ul> <p><strong>2.	Hesap bilgisi hizmeti müşteri rızasının tesisi:</strong></p> <p>HHS, Hesap Bilgisi Rızası servisi ile ÖHK özelinde “Yetki bekleniyor” statüsünde bir rıza nesnesi hazırlar. HHS, GKD’nin başarıyla tamamlanması sonrasında hesap bilgisi rızası nesnesinin yetkilendirildiğini belirtmek için Rıza Durumunu “Rıza Yetkilendirildi” olarak günceller. Nesne yetkilendirildikten sonra HHS nesne ile bir erişim belirteci (access token) ilişkilendirir, Rıza Durumunu “Yetki Kullanıldı” yapar ve bu belirteci HBHS’ye geri döner.  Böylece müşteri rıza tesisi sağlanmış olur.</p> <p>Hesap bilgisi için müşteri rızasına ilişkin temel ilkeler şunlardır:</p> <ul><li>1 ÖHK'nın 1 YÖS için 1HHS'de Yetki Bekleniyor, Yetkilendirildi, Yetki Kullanıldı statüsünde 1 rızası olabilir.</li> <li>Müşteri rızasının ayrıntıları ÖHK ile HBHS arasında belirlenir. Bu nedenle müşteri rızasının ayrıntıları HHS ekranında değiştirilmemelidir.</li> <li>ÖHK, hesap erişim izni ayrıntılarını yalnızca bir bütün olarak yetkilendirebilir veya geri alabilir.</li> <li>Müşteri rızası tesisi esnasında, müşteri HHS arayüzünde erişim için yetkilendirecek hesapları seçer.</li></ul> <p><strong>2.1	Hesap bilgisi rızasının sorgulanması:</strong> Müşteri rızası <strong>GET/hesap-bilgisi-rizasi/{RizaNo}</strong> çağrısı yapılarak sorgulanır.</p> <p><strong>2.2	Hesap bilgisi müşteri rızasının iptali:</strong> Müşteri rızası <strong>DELETE/hesap-bilgisi-rizasi/{RizaNo}</strong> çağrısı yapılarak iptal edilir.</p> <p><strong>3.	Hesap bilgilerinin alınması:</strong> Hesap bilgileri ilgili kaynağa (hesaplar, bakiye, işlemler) GET isteği yapılarak gerçekleştirilir. HBHS, müşteri rızasının tesisinden sonrasında (geçerli bir erişim belirticine sahip olduğunda) öncelikle <strong>GET/hesaplar</strong> çağrısı yapacaktır.</p> <h2 id="hesap-bilgisi-hizmeti-icin-erisim-adresleri"><a href="#hesap-bilgisi-hizmeti-icin-erisim-adresleri" class="header-anchor">#</a> Hesap Bilgisi Hizmeti İçin Erişim Adresleri</h2> <p><strong>Etki Alanı (Scope) =“hesap_bilgisi”</strong></p> <table><thead><tr><th>No</th> <th>Kaynak</th> <th>HTTP işlemi</th> <th>Erişim Adresi</th> <th>Zorunlu / İsteğe Bağlı</th> <th>Yetkilendirme Türü</th> <th>İmzalama</th> <th>Parametre</th> <th>İstem Nesnesi</th> <th>Yanıt Nesnesi</th></tr></thead> <tbody><tr><td>1</td> <td>hesap-bilgisi-rizasi</td> <td>POST</td> <td>/hesap-bilgisi-rizasi</td> <td>Z</td> <td>İstemci Kimlik Bilgileri</td> <td>İmzalı İstek ve Yanıt</td> <td></td> <td>HesapBilgisiRizasiIstegi</td> <td>HesapBilgisiRizasi</td></tr> <tr><td>2</td> <td>erisim-belirteci  (GKD için)</td> <td>POST</td> <td>/erisim-belirteci</td> <td>Z</td> <td>İstemci Kimlik Bilgileri</td> <td>İmzalı İstek ve Yanıt</td> <td></td> <td>ErisimBelirteciIstegi</td> <td>ErisimBelirteci</td></tr> <tr><td>2.1</td> <td>hesap-bilgisi-rizasi</td> <td>GET</td> <td>/hesap-bilgisi-rizasi/{RizaNo}</td> <td>Z</td> <td>İstemci Kimlik Bilgileri</td> <td>İmzalı Yanıt</td> <td></td> <td></td> <td>HesapBilgisiRizasi</td></tr> <tr><td>2.2</td> <td>hesap-bilgisi-rizasi</td> <td>DELETE</td> <td>/hesap-bilgisi-rizasi/{RizaNo}</td> <td>Z</td> <td>İstemci Kimlik Bilgileri</td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>3.1</td> <td>hesaplar</td> <td>GET</td> <td>/hesaplar</td> <td>Z</td> <td>İstemci Kimlik Bilgileri ve Yetkilendirme Kodu (GKD)</td> <td></td> <td>Sayfalama</td> <td></td> <td>HesapBilgileri(birden çok hesap)</td></tr> <tr><td>3.2</td> <td>hesaplar</td> <td>GET</td> <td>/hesaplar/{hspRef}</td> <td>Z</td> <td>İstemci Kimlik Bilgileri ve Yetkilendirme Kodu (GKD)</td> <td></td> <td></td> <td></td> <td>HesapBilgileri(tek  hesap)</td></tr> <tr><td>3.3</td> <td>bakiye</td> <td>GET</td> <td>/hesaplar/{hspRef}/bakiye</td> <td>Z</td> <td>İstemci Kimlik Bilgileri ve Yetkilendirme Kodu (GKD)</td> <td></td> <td></td> <td></td> <td>BakiyeBilgileri(tek  hesap)</td></tr> <tr><td>3.4</td> <td>bakiye</td> <td>GET</td> <td>/bakiye</td> <td>İ</td> <td>İstemci Kimlik Bilgileri ve Yetkilendirme Kodu (GKD)</td> <td></td> <td>Sayfalama</td> <td></td> <td>BakiyeBilgileri(birden çok hesap)</td></tr> <tr><td>3.5</td> <td>islemler</td> <td>GET</td> <td>/hesaplar/{hspRef}/işlemler</td> <td>Z</td> <td>İstemci Kimlik Bilgileri ve Yetkilendirme Kodu (GKD)</td> <td></td> <td>Sayfalama Filtreleme</td> <td></td> <td>IslemBilgileri (tek hesap)</td></tr></tbody></table> <p><strong>Tablo 11: Hesap Bilgisi Hizmeti İçin Erişim Adresleri</strong></p> <h2 id="adim-0-ohk-nın-hesap-bilgilerine-erisim-icin-talepte-bulunması"><a href="#adim-0-ohk-nın-hesap-bilgilerine-erisim-icin-talepte-bulunması" class="header-anchor">#</a> ADIM 0: ÖHK'nın hesap bilgilerine erişim için talepte bulunması:</h2> <p>ÖHK, HBHS uygulamasında (web arayüzü/mobil uygulama) hesap bilgilerine erişim için talepte bulunur.</p> <h2 id="_7-1-adim-1-hesap-bilgisi-rızasının-hazırlanması"><a href="#_7-1-adim-1-hesap-bilgisi-rızasının-hazırlanması" class="header-anchor">#</a> 7.1 ADIM 1: Hesap Bilgisi Rızasının Hazırlanması</h2> <p>Bu API çağrısı HBHS'nin HHS'de yeni bir “HesapBilgisiRizasi” nesnesi oluşturmasını ve nesneye erişmek için benzersiz bir rıza numarası ({RizaNo}) dönülmesini sağlar.</p> <p>API çağrısının başarıyla sonuçlanması için HBHS'nin istemci kimlik bilgileri yetkisi kullanması yeterlidir.
Başarıyla oluşturulan hesap bilgisi rıza kaynağının rıza durumu “Yetki Bekleniyor” olarak düzenlenir.
ÖHK daha önce aldığı rızaya ilişkin erişim tarihleri, izin türlerini ve hesap bilgilerini güncellemek isterse, HBHS önce HHS nezdindeki rızayı iptal etmeli ve sonrasında yeni bir rıza talebinde bulunmalıdır.
 <img src="/assets/img/HesapBilgisiMusteriRizasininHazirlanmasi.c0e1b04d.png" width="80%"></p> <p><strong>Şekil 11: Hesap Bilgisi Müşteri Rızasının Hazırlanması</strong></p> <ul><li>POST /hesap-bilgisi-rizasi isteğinin (REQUEST) gövdesinde (BODY)  “HesapBilgisiRizasıIstegi” nesnesi (Tablo-12) kullanılır. İstek başarıyla sonuçlanırsa HHS kaynak sunucusunda “HesapBilgisiRizasi” (Tablo-13) nesnesi oluşturulur.</li></ul> <h3 id="post-hesap-bilgisi-rizasi"><a href="#post-hesap-bilgisi-rizasi" class="header-anchor">#</a> <strong>POST /hesap-bilgisi-rizasi</strong></h3> <h3 id="basarılı-istek"><a href="#basarılı-istek" class="header-anchor">#</a> Başarılı İstek:</h3> <p>İSTEK:</p> <p>HBHS, bu API erişim adresinden HHS’ye yeni bir HesapBilgisiRizasi oluşturulması için istekte bulunur:</p> <ul><li>HBHS, ÖHK’nın hesap bilgilerine yönelik rıza başlatma isteği olduğunu HHS’ye bildirir.</li> <li>HBHS, ÖHK’nın, HBHS arayüzünden verdiği rızanın (“Ön Onay”) bir kopyasının HHS nezdinde müşteri tarafından onaylanması için HHS’ye gönderilmesini sağlar.</li> <li>HHS; istek mesajında yer alan alanların API dökümanında belirtilen şartları sağlayacak şekilde zorunluluk ve uzunluk kontrollerini yapar. (Zorunlu)</li> <li>HHS; YÖS API ile alınan HBHS bilgilerinin içerisinde yer alan yönlendirme ve bildirim adresleri ile ödeme emri rızası nesnesi request mesajında paylaşılan adreslerin uyumlu olup olmadığının kontrollerini yapar. (Zorunlu)</li> <li>HHS; kimlik bilgileri nesnesinde iletilen kimlik bilgileri ile ÖHK’nın HHS müşterisi olup olmadığının kontrollerini yapar. Bu kontrol hem bireysel hem de kurumsal ÖHK’lar için yapılmalıdır.  (Zorunlu)</li> <li>Erişimin Geçerli Olduğu Son Tarih, İşlem Sorgulama Başlangıç Zamanı, İşlem Sorgulama Bitiş Zamanı alanları ile ilgili Tablo 12’de belirtilen kontroller yapılmalıdır. (Zorunlu)</li> <li>HHS, benzersiz “RizaNo” ile “HesapBilgisiRizasi” nesnesi oluşturur ve HBHS’ye döner.</li> <li>HHS, HesapBilgisiRizasi oluşturduğu anda durumunu “Yetki Bekleniyor” olarak düzenler.</li></ul> <p>Erişimin Geçerli Olduğu Son Tarih, İşlem Sorgulama Başlangıç Zamanı, İşlem Sorgulama Bitiş Zamanı alanlarında zaman aralıkları müşteri deneyimi penceresinden değerlendirilerek ay cinsinden belirtilmiştir. Bu konuda aşağıdaki gibi oluşabilecek uç örneklere dikkat edilmesi gerekmektedir.</p> <p>Bugün : 31.08.2019<br>
Bugün + 6 Ay : 29.02.2020<br>
Bugün : 30.08.2020<br>
Bugün + 6 Ay : 28.02.2021
Bugün : 30.09.2022<br>
Bugün + 3 Ay : 30.12.2022
Bugün : 14.07.2022<br>
Bugün + 3 Ay : 14.10.2022</p> <p><strong>Tablo 12: “HesapBilgisiRizasiIstegi” nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th> <th>HHS tarafından yapılması gereken kontrol ve işlemler</th></tr></thead> <tbody><tr><td>Katılımcı Bilgisi</td> <td>katilimciBlg</td> <td>Kompleks:KatilimciBilgisi</td> <td>Z</td> <td>Katılımcılara atanmış kod bilgileridir.</td> <td></td></tr> <tr><td>&gt;Hesap Hizmeti Sağlayıcısı Kodu</td> <td>hhsKod</td> <td>AN4</td> <td>Z</td> <td>İsteğin iletildiği Hesap Hizmeti Sağlayıcısının kodudur. (Nezdinde ÖH bulunduran kuruluş kodu. Örneğin, Banka, Elektronik Para Kuruluşu ve Ödeme Kuruluşu)</td> <td>HHS, hhsKod’un kendisine ait olduğunu ve istek başlığındaki x-aspsp-code değeri ile aynı olduğunu kontrol eder. Hata durumunda TR.OHVPS.Connection.InvalidASPSP hata kodunu döner.</td></tr> <tr><td>&gt; Yetkili Ödeme Hizmeti Sağlayıcısı Kodu</td> <td>yosKod</td> <td>AN4</td> <td>Z</td> <td>İsteği gönderen Yetkili Ödeme Hizmeti Sağlayıcısı (YÖS) kodudur</td> <td>HHS, yosKod’un geçerli bir Ödeme Hizmeti Sağlayıcısı Kodu olduğunu ve istek başlığındaki x-tpp-code değeri ile aynı olduğunu kontrol eder.  Hata durumunda TR.OHVPS.Connection.InvalidTPP hata kodunu döner.</td></tr> <tr><td>GKD</td> <td>gkd</td> <td>Kompleks:Gkd</td> <td>Z</td> <td></td> <td></td></tr> <tr><td>&gt;Yetkilendirme Yöntemi</td> <td>yetYntm</td> <td>AN1</td> <td>İ</td> <td>TR.OHVPS.DataCode.GkdTur sıralı veri türü değerlerinden birini alır.  <br>Yetkilendirme yöntemi, HBHS tarafından belirtilmeyebilir.</td> <td>HHS, HBHS’nin belirlediği yöntemi dikkate alarak kendi belirlediği yöntemi kullanır.</td></tr> <tr><td>&gt; Yönlenme Adresi</td> <td>yonAdr</td> <td>AN1..1024</td> <td>K</td> <td>Yönlendirmeli güçlü kimlik doğrulama için zorunludur. <br>YÖS Yönlendirmeli GKD yöntemi ile akışı destekliyorsa, yetYntm değişkeninden bağımsız olarak yönlendirme adresini iletmelidir. Durum kodu(drmKod), yönlendirme adresine parametre olarak eklenmelidir.</td> <td>HHS, müşteri uygulama / tarayıcısını bu alanda belirtilen adrese yönlendirir.</td></tr> <tr><td>&gt; Bildirim Adresi</td> <td>bldAdr</td> <td>AN1..1024</td> <td>K</td> <td>Ayrık güçlü kimlik doğrulama için zorunludur. <br>YÖS Ayrık GKD yöntemi ile akışı destekliyorsa, yetYntm değişkeninden bağımsız olarak bildirim adresini iletmelidir.<br> Durum kodu(drmKod), yönlendirme adresine parametre olarak eklenmelidir.</td> <td>HHS, ayrık GKD sonrası bu alanda belirtilen adrese otorizasyon kodunu (authentication code) iletir.</td></tr> <tr><td>Kimlik</td> <td>kmlk</td> <td>Kompleks:Kimlik</td> <td>Z</td> <td></td> <td></td></tr> <tr><td>&gt; Kimlik Türü</td> <td>kmlkTur</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.KimlikTur sıralı veri türü değerlerinden birini alır. <br> Kurum adına yapılan(ticari) işlemlerde kurum kullanıcısının bilgisi iletilmelidir.</td> <td></td></tr> <tr><td>&gt; Kimlik Verisi</td> <td>kmlkVrs</td> <td>AN1..30</td> <td>Z</td> <td>HHS nezdinde kullanıcı doğrulamasında kullanılan tanımlayıcıdır. <br> TR.OHVPS.DataCode.KimlikTur değerine göre uzunluk ve formatı değişir. <br> Kurum adına yapılan(ticari) işlemlerde kurum kullanıcısının bilgisi iletilmelidir.</td> <td></td></tr> <tr><td>&gt; Kurum Kimlik Türü</td> <td>krmKmlkTur</td> <td>AN1</td> <td>K</td> <td>ÖHK’nın altında tanımlı olduğu tüzel kişilik için kullanılan kurum kimlik türüdür. <br>TR.OHVPS.DataCode.KurumKimlikTur sıralı veri türü değerlerinden birini alır.</td> <td></td></tr> <tr><td>&gt; Kurum Kimlik Verisi</td> <td>krmKmlkVrs</td> <td>AN1..30</td> <td>K</td> <td>ÖHK’nın altında tanımlı olduğu tüzel kişilik için kullanılan kurum kimlik verisidir. <br>TR.OHVPS.DataCode.KurumKimlikTur değerine göre uzunluk ve formatı değişir.</td> <td></td></tr> <tr><td>&gt; Ödeme Hizmeti Kullanıcısı Türü</td> <td>ohkTur</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.OhkTur sıralı veri türü değerlerinden birini alır (B: Bireysel, K:Kurumsal)</td> <td></td></tr> <tr><td>Hesap Bilgisi</td> <td>hspBlg</td> <td>Kompleks: HesapBilgisi</td> <td>Z</td> <td></td> <td></td></tr> <tr><td>&gt;İzin Bilgisi</td> <td>iznBlg</td> <td>Kompleks: IzinBilgisi</td> <td>Z</td> <td></td> <td></td></tr> <tr><td>&gt;&gt; İzin Türü</td> <td>iznTur</td> <td>Array[AN2]</td> <td>Z</td> <td>ÖHK tarafından HHS önyüzünde belirlenen izin tipleridir. Bir istekte birden fazla değer bulunabilir, TR.OHVPS.DataCode.IzinTur sıralı veri türü değerlerinden birini alır.</td> <td></td></tr> <tr><td>&gt;&gt; Erişimin Geçerli Olduğu Son Tarih</td> <td>erisimIzniSonTrh</td> <td>ISODateTime</td> <td>Z</td> <td>Hesap bilgisi rızasının geçerli olduğu son tarih. <br> Müşteri YÖS ekranından bu değeri belirleyebilir. <br> Varsayılan değer : Rıza verilen tarih + 6 ay <br> Alabileceği maksimum değer : Rıza tarihi + 6 ay <br>  Alabileceği minimum değer : Rıza tarihi + 1 gün <br> Örneğin 23/09/2021’de minimum 24/09/2021 seçilebilir. Bu durumda izin 24/09/2021 23:59:59’da bitecek şekilde olmalıdır.</td> <td>Bu alanda bir değer bulunmadığı durumda HHS hata dönmelidir.</td></tr> <tr><td>&gt;&gt; İşlem Sorgulama Başlangıç Zamanı</td> <td>hesapIslemBslZmn</td> <td>ISODateTime</td> <td>K</td> <td>Hesap bilgisi rızası verilmesinden geçmişe dönük en fazla 12 ay olabilir, daha eski olmaması gerekir. <br> Varsayılan değeri rıza verilen tarih (işlem zamanı) – 12 aydır. <br> ÖHK bu alana bir değer girişi sağlamamış ise ÖBHS varsayılan değerlerle bu alanı doldurarak, HHS’ye iletir. <br> Minimum tarihi : Rızanın veriliş tarihi  - 12 ay  <br> Maksimum tarih: Rızanın veriliş tarihi +  12 ay  <br> İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçildiğinde bu alanların doldurulması zorunludur.<br> İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmemiş ise gönderilmemelidir.</td> <td>ÖHK tarafından izin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmemiş ve  İşlem Sorgulama Başlangıç Zamanı ÖBHS tarafından dolu olarak gönderilmiş ise HHS tarafından işlemin devamına izin verilmez.<br>İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmiş ise; HHS bu alanın alabileceği minimum ve maksimum değerlerin sınırlar içerisinde olduğunu kontrol eder.</td></tr> <tr><td>&gt;&gt; İşlem Sorgulama Bitiş Zamanı</td> <td>hesapIslemBtsZmn</td> <td>ISODateTime</td> <td>K</td> <td>Hesap bilgisi rızası verilmesinden geleceğe dönük en fazla 12 ay sonrası olabilir, daha ileri bir tarih olmaması gerekir. <br> Varsayılan değeri: Rıza verilen tarih + 12 aydır.<br> ÖHK bu alana bir değer girişi sağlamamış ise ÖBHS varsayılan değerlerle bu alanı doldurarak, HHS’ye iletir.<br> Minimum tarihi : Rızanın veriliş tarihi  – 12 ay<br> Maksimum tarihi :  Rızanın veriliş tarihi + 12 ay <br> İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçildiğinde bu alanların doldurulması zorunludur.<br> İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmemiş ise gönderilmemelidir. Eğer dolu gönderilirse HHS tarafından uygun hata mesajı iletilmelidir.</td> <td>ÖHK tarafından izin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmemiş ve İşlem Sorgulama Bitiş Zamanı ÖBHS tarafından dolu olarak gönderilmiş ise HHS tarafından işlemin devamına izin verilmez. <br> İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçilmiş ise; HHS bu alanın alabileceği minimum ve maksimum değerlerin sınırlar içerisinde olduğunu kontrol eder.</td></tr></tbody></table> <h3 id="basarılı-yanıt"><a href="#basarılı-yanıt" class="header-anchor">#</a> Başarılı Yanıt:</h3> <p><strong>Tablo 13: HesapBilgisiRizasi nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>Riza Bilgileri</td> <td>rzBlg</td> <td>Kompleks: RizaBilgileri</td> <td>Z</td> <td></td></tr> <tr><td>&gt; Rıza No</td> <td>rizaNo</td> <td>AN1..128</td> <td>Z</td> <td>HesapBilgisiRızasi nesnesinin oluşturulması esnasında HHS kaynak sunucusu tarafından atanan biricik tanımlayıcı</td></tr> <tr><td>&gt; Oluşturma Zamanı</td> <td>olusZmn</td> <td>ISODateTime</td> <td>Z</td> <td>HesapBilgisiRızası nesnesinin oluşturulma zamanı</td></tr> <tr><td>&gt; Güncellenme Zamanı</td> <td>gnclZmn</td> <td>ISODateTime</td> <td>Z</td> <td>HesapBilgisiRızası nesnesinin güncellenme zamanı</td></tr> <tr><td>&gt; Rıza Durumu</td> <td>rizaDrm</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.RizaDurumu sıralı veri tipini değerlerinden birini alır. Örn; hesap bilgi rızasının tesisine dair ilk istek mesajına dönüşte “B: Yetki Bekleniyor” değerini alması beklenir.</td></tr> <tr><td>&gt; Rıza Iptal Detay Kodu</td> <td>rizaIptDtyKod</td> <td>AN2</td> <td>K</td> <td>Rıza durumunun iptal olduğu durumda zorunludur.</td></tr> <tr><td>Kimlik</td> <td>kmlk</td> <td>Kompleks:Kimlik</td> <td>Z</td> <td></td></tr> <tr><td>&gt; Kimlik Türü</td> <td>kmlkTur</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.KimlikTur sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt; Kimlik Verisi</td> <td>kmlkVrs</td> <td>AN1..30</td> <td>Z</td> <td>HHS nezdinde kullanıcı doğrulamasında kullanılan tanımlayıcıdır. TR.OHVPS.DataCode.KimlikTur değerine göre uzunluk ve formatı değişir.</td></tr> <tr><td>&gt; Kurum Kimlik Türü</td> <td>krmKmlkTur</td> <td>AN1</td> <td>K</td> <td>ÖHK’nın altında tanımlı olduğu tüzel kişilik için kullanılan kurum kimlik türüdür.<br> TR.OHVPS.DataCode.KurumKimlikTur sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt; Kurum Kimlik Verisi</td> <td>krmKmlkVrs</td> <td>AN1..30</td> <td>K</td> <td>ÖHK’nın altında tanımlı olduğu tüzel kişilik için kullanılan kurum kimlik verisidir.<br> TR.OHVPS.DataCode.KurumKimlikTur değerine göre uzunluk ve formatı değişir.</td></tr> <tr><td>&gt; Ödeme Hizmeti Kullanıcısı Türü</td> <td>ohkTur</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.OhkTur sıralı veri türü değerlerinden birini alır (B: Bireysel, K:Kurumsal)</td></tr> <tr><td>Katılımcı Bilgisi</td> <td>katilimciBlg</td> <td>Kompleks:KatilimciBilgisi</td> <td>Z</td> <td>Katılımcılara atanmış kod bilgileridir.</td></tr> <tr><td>&gt;Hesap Hizmeti Sağlayıcısı Kodu</td> <td>hhsKod</td> <td>AN4</td> <td>Z</td> <td>İsteğin iletildiği Hesap Hizmeti Sağlayıcısının kodudur. (Nezdinde ÖH bulunduran kuruluş kodu. Örneğin, Banka, Elektronik Para Kuruluşu ve Ödeme Kuruluşu)</td></tr> <tr><td>&gt; Yetkili Ödeme Hizmeti Sağlayıcısı Kodu</td> <td>yosKod</td> <td>AN4</td> <td>Z</td> <td>İsteği gönderen Yetkili Ödeme Hizmeti Sağlayıcısı (YÖS) kodudur.</td></tr> <tr><td>GKD</td> <td>gkd</td> <td>Kompleks:Gkd</td> <td>Z</td> <td></td></tr> <tr><td>&gt; Yetkilendirme Yöntemi</td> <td>yetYntm</td> <td>AN1</td> <td>K</td> <td>HHS, HBHS’nin belirlediği yöntemi dikkate alarak kendi belirlediği yöntemi kullanır.<br> TR.OHVPS.DataCode.GkdTur sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt; Yönlenme Adresi</td> <td>yonAdr</td> <td>AN1..1024</td> <td>K</td> <td>HHS, müşteri uygulama / tarayıcısını bu alanda belirtilen YÖS adresine yönlendirir.</td></tr> <tr><td>&gt; Bildirim Adresi</td> <td>bldAdr</td> <td>AN1..1024</td> <td>K</td> <td>HHS, ayrık GKD sonrası bu alanda belirtilen YÖS adresine otorizasyon kodunu (authentication code) iletir.</td></tr> <tr><td>&gt; HHS Yönlenme Adresi</td> <td>hhsYonAdr</td> <td>AN1..1024</td> <td>K</td> <td>GKD doğrulama bilgilerinin girilebilmesi için uygulamadan açılacak yönlendirme sayfasının adresi.</td></tr> <tr><td>&gt; Yetkilendirme Tamamlanma Zamanı</td> <td>yetTmmZmn</td> <td>ISODateTime</td> <td>Z</td> <td>Yetkilendirme akışının tamamlanması gereken son zamanı gösterir.  HHS tarafından maksimum 5 dk içinde işlem tamamlanacak şekil zaman damgası oluşturulur. Zaman aşımı olduğunda HHS’nin GKD’ye izin vermeyecek şekilde hata mesajı vermesi gerekmektedir.<br>Rıza durumu Yetkilendirildi statüsüne geçene kadarki süredir.</td></tr> <tr><td>Hesap Bilgisi</td> <td>hspBlg</td> <td>Kompleks: HesapBilgisi</td> <td>Z</td> <td></td></tr> <tr><td>&gt; İzin Bilgisi</td> <td>iznBlg</td> <td>Kompleks: IzinBilgisi</td> <td>Z</td> <td></td></tr> <tr><td>&gt;&gt; İzin Türü</td> <td>iznTur</td> <td>Array[AN2]</td> <td>Z</td> <td>ÖHK tarafından HBHS önyüzünde belirlenen izin tipleridir. Bir istekte birden fazla değer bulunabilir, TR.OHVPS.DataCode.IzinTur sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt;&gt; Erişimin Geçerli Olduğu Son Tarih</td> <td>erisimIzniSonTrh</td> <td>ISODateTime</td> <td>Z</td> <td>Hesap bilgisi rızasının geçerli olduğu son tarih</td></tr> <tr><td>&gt;&gt; İşlem Sorgulama Başlangıç Zamanı</td> <td>hesapIslemBslZmn</td> <td>ISODateTime</td> <td>K</td> <td>Hesap hareketlerinin sorgunabileceği başlangıç zamanı. İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçildiğinde bu alanların doldurulması zorunludur.</td></tr> <tr><td>&gt;&gt; İşlem Sorgulama Bitiş Zamanı</td> <td>hesapIslemBtsZmn</td> <td>ISODateTime</td> <td>K</td> <td>Hesap hareketlerinin sorgunabileceği bitiş zamanı. İzin türü “Temel işlem Bilgisi” ve/veya “Ayrıntılı İşlem Bilgisi” seçildiğinde bu alanların doldurulması zorunludur.</td></tr> <tr><td>&gt; Ayrıntı Bilgi</td> <td>ayrBlg</td> <td>Kompleks: AyrintiBilgi</td> <td>İ</td> <td></td></tr> <tr><td>&gt; ÖHK Mesaj Alanı</td> <td>ohkMsj</td> <td>AN1..200</td> <td>İ</td> <td>HHS’nin ÖHK’ya göstermek üzere ilettiği mesaj.</td></tr></tbody></table> <h2 id="izinler"><a href="#izinler" class="header-anchor">#</a> İzinler</h2> <p>Bir hesap bilgisi müşteri rızası kaynağı çağrısına yanıt olarak döndürülen verileri sınırlamak için izin kodları kullanılır:</p> <ul><li>Temel Hesap Bilgisi</li> <li>Ayrıntılı Hesap Bilgisi</li> <li>Bakiye Bilgisi</li> <li>Temel İşlem (Hesap Hareketleri) Bilgisi</li> <li>Ayrıntılı İşlem Bilgisi</li></ul> <p>ÖHK’ya sunulacak seçimler ve kuralları aşağıdaki gibi olmalıdır.</p> <table><thead><tr><th>Seçim</th> <th>Kural</th></tr></thead> <tbody><tr><td>Temel Hesap Bilgisi</td> <td>ÖHK seçimine sunulmamalıdır. Değiştirilemez şekilde seçili gösterilmelidir.</td></tr> <tr><td>Ayrıntılı Hesap Bilgisi</td> <td>ÖHK seçim yapabilir.</td></tr> <tr><td>Bakiye Bilgisi</td> <td>ÖHK seçim yapabilir.</td></tr> <tr><td>Temel İşlem (Hesap Hareketleri)  Bilgisi</td> <td>ÖHK seçim yapabilir.</td></tr> <tr><td>Ayrıntılı İşlem Bilgisi</td> <td>ÖHK seçim yapabilir. Ayrıntılı İşlem Bilgisi seçimi Temel İşlem Bilgisi seçimini kapsar. (Ayrıntılı İşlem bilgisi seçildiğinde Temel İşlem Bilgisi de seçili olmalıdır.)</td></tr></tbody></table> <p>Aşağıdaki durumlarda, izin kombinasyonlarına izin verilmez. HHS, bu hesap erişim onaylarını 400 (Hatalı İstek) yanıt koduyla reddetmelidir:</p> <ul><li>İzin dizisinin herhangi bir izin türü içermemesi durumu,</li> <li>İzin dizisinde HHS tarafından desteklenmeyen bir izin kodunun yer alması durumu</li></ul> <h2 id="_7-2-adim-2-hesap-bilgisi-hizmeti-rızasının-tesisi"><a href="#_7-2-adim-2-hesap-bilgisi-hizmeti-rızasının-tesisi" class="header-anchor">#</a> 7.2 ADIM 2: Hesap Bilgisi Hizmeti Rızasının Tesisi</h2> <img src="/assets/img/HesapBilgisiMusteriRizasininTesisi.eeb4ed50.png" width="80%"> <p><strong>Şekil 12: Hesap Bilgisi ÖHK Rızasının Tesisi</strong></p> <p>Rıza tesisinin başarıyla sonuçlanması için HBHS'nin istemci kimlik bilgileri yetkisi kullanması ve ardından müşterinin HHS tarafından yönlendirmeli veya ayrık GKD ile doğrulanması gerekir. HHS'de oluşturulan ve rıza durumu “Yetki Bekleniyor” olan bir hesap bilgisi rızası, GKD sonrası “Yetkilendirildi” statüsüne güncellenir. HBHS, erişim sağlayacağı hesapları hesap bilgisi rızasının tesisinden önce seçer.</p> <ul><li><p>Yönlendirmeli doğrulama akışında, HBHS ÖHK’yı HHS’ye yönlendirir.</p> <ul><li><p>HBHS tarafından yönlendirme, bir önceki adımdaki RizaNo’yu içerir.</p></li> <li><p>HHS, ÖHK için GKD sürecini işletir.</p> <p>ÖHK’yı doğrularsa,</p> <ul><li><p>ÖHK HBHS üzerinden işlem yapılmasına izin vereceği hesap seçimini yapar. HBHS üzerinden ÖHK’nın verdiği izin bilgilerini ve erişim izninin bitiş tarihi bilgilerini, HHS bilgilendirme amaçlı ÖHK’ya gösterir.</p></li> <li><p>HHS hesap bilgisiri rıza kaynağının durumunu “Yetkilendirildi” olarak günceller.</p></li> <li><p>HHS, ÖHK’yı “olumlu yönlendirme akışı” ile HBHS tarafından tanımlanan yönlendirme adresine yönlendirir:</p> <div class="language- extra-class"><pre><code>yonAdr?rizaDrm=Y&amp;yetKod=xx&amp;rizaNo=yy&amp;rizaTip=H&amp;drmKod=zzz
</code></pre></div></li></ul> <p>ÖHK’yı doğrulayamazsa,</p> <ul><li><p>HHS, hesap bilgisi rıza kaynağının durumunu “Yetki İptal” olarak günceller.</p></li> <li><p>HHS, ÖHK’yı “olumsuz yönlendirme akışı” ile HBHS tarafından tanımlanan yönlendirme adresine yönlendirir:</p> <div class="language- extra-class"><pre><code>yonAdr?rizaDrm=I &amp;rizaNo=yy&amp;rizaTip=H&amp;rizaIptDtyKod=11&amp;drmKod=zzz
</code></pre></div></li></ul></li></ul></li> <li><p>Ayrık doğrulama akışında, HHS, ÖHK’nın hesap bilgisi hizmetini başlattığı uygulamadan farklı olabilecek bir “doğrulama” uygulamasında işlemi doğrulamasını ister.</p> <ul><li>Ayrık akış HBHS’nin farklı bir kanal kullanarak yetkilendirme isteği göndermesiyle başlatılır.</li> <li>Bu yetkilendirme isteği, yetkilendirilecek hesap bilgisi rızasının eşleştirileceği ÖHK’nın bulunması için ilgili veriyi taşır.</li> <li>HHS, ödeme hizmeti kullanıcısını doğrular.</li> <li>ÖHK verdiği izin tipi dahilinde bilgileri paylaşılacak olan hesapları seçer.</li> <li>HHS, hesap bilgisi rıza kaynağının durumunu “Yetkilendirildi” olarak günceller.</li></ul></li></ul> <p>Başarılı GKD sonrasında (rizaDrm=’Y’) ilgili rıza nesnesi için (belirli bir rizaNo) yetkilendirme kodunun (yetKod) alınmasının ardından erişim belirteci erişim adresine POST çağrısı yapılarak yetkilendirme kodu karşılığında erişim belirteci ve yenileme belirteci alınır. POST /erişim-belirteci erişim noktası EK-3’te açıklanmıştır.</p> <p>Erişim belirteci alındıktan sonra; HHS,  hesap bilgisi rızasının durumunu “Yetki Kullanıldı” olarak günceller. Rıza tesisi sağlanmış olur.</p> <h2 id="_7-3-adim-2-1-hesap-bilgisi-rızasının-sorgulanması-istege-baglı"><a href="#_7-3-adim-2-1-hesap-bilgisi-rızasının-sorgulanması-istege-baglı" class="header-anchor">#</a> 7.3 ADIM 2.1: Hesap Bilgisi Rızasının Sorgulanması (İsteğe Bağlı)</h2> <p><strong>GET /hesap-bilgisi-rizasi/{RizaNo}</strong></p> <p>ÖHK, HHS üzerinden rıza iptali yapmış olabilir veya ÖHK’nın verdiği rıza süresi dolmuş olabilir.  Bu durumlarda HBHS, rıza alma akışına başlamadan önce, daha önce oluşturulmuş bir HesapBilgisiRizasi kaynağının durumunu, isteğe bağlı olarak alabilir.</p> <p>Servis başarılı yanıtında Tablo 13’de belirtilen “HesapBilgisiRizasi” nesnesini dönmektedir.</p> <p>Durum<br>
HesapBilgisiRizasi kaynağı için kullanılabilecek durum göstergeleri şu şekildedir:</p> <ul><li>Yetki Bekleniyor</li> <li>Yetkilendirildi</li> <li>Yetki Kullanıldı</li> <li>Yetki Sonlandırıldı</li> <li>Yetki İptal</li></ul> <h2 id="_7-4-adim-2-2-hesap-bilgisi-rızasının-iptali"><a href="#_7-4-adim-2-2-hesap-bilgisi-rızasının-iptali" class="header-anchor">#</a> 7.4 ADIM 2.2: Hesap Bilgisi Rızasının İptali</h2> <br> <img src="/assets/img/HesapBilgisiMusteriRizasininGeriAlinmasi.3515faa0.png" width="80%"> <br> <p><strong>Şekil 13: Hesap Bilgisi Müşteri Rızasının Geri Alınması</strong></p> <p><strong>DELETE /hesap-bilgisi-rizasi/{RizaNo}</strong></p> <p>DELETE /hesap-bilgisi-rizasi çağrısı, bir HBHS'nin önceden oluşturulmuş bir hesap erişim rızasını (yetkili olsun veya olmasın) silmesine izin verir. Müşteri, rızasını HHS üzerinden iptal etmek yerine, HBHS üzerinden bu rızasını kaldırmak isteyebilir.<br>
Bu API çağrısı, müşterinin HBHS üzerinden hesap bilgisi rızasını iptal etmesine ve HHS nezdindeki hesap bilgisi rızası nesnesinin silinmesini sağlar.<br>
Müşterinin HBHS’nin veri erişim iznini iptal etmesi durumunda HBHS, HHS’de mevcut olan HesapBilgisiRizasi kaynağını pratik olarak mümkün olan en kısa sürede silmelidir. Bu ise, ilgili kaynağa<br> <strong>DELETE /hesap-bilgisi-rizasi/{RizaNo}</strong><br>
çağrısı aracılığı ile yerine getirilir. HBHS ayrıca, sisteminden Hesap Erişim İzni kaynaklarını da temizlemelidir.<br>
Söz konusu silme işlemi, kayıtların statüsünün pasife çekilmesi ile gerçekleştirilmelidir. Söz konusu kayıtlar, denetim izlerinin oluşturulması ve saklanmasına ilişkin ikincil düzenleme hükümleri kapsamında güvenli şekilde tutulmalıdır.<br>
Servis istek parametresi olarak sadece path’de iletilen Rıza No bilgisine ihtiyaç duymaktadır.<br>
ÖHK rızası başarı ile silindiğinde HTTP 204 response kodu ile işlem sonucu iletilir. Rıza tipi “I” yani “Yetki İptal” olarak güncellenir ve gnclZmn zaman damgası vurularak güncellenir.<br>
ÖHK ile rıza iptali sırasında kurulacak iletişimde (e-posta, sms gibi) aşağıdaki alanların iletilmesi tavsiye edilmektedir:<br>
YÖS Adı, HHS adı, Rıza Oluşturma Zamanı, Servis Tipi Bilgisi (HBHS)<br></p> <h2 id="_7-5-adim-3-hesap-bilgilerinin-alınması"><a href="#_7-5-adim-3-hesap-bilgilerinin-alınması" class="header-anchor">#</a> 7.5 ADIM 3: Hesap Bilgilerinin Alınması</h2> <br> <img src="/assets/img/HesapBilgilerininAlinmasi.163a75f5.png" width="80%"> <p><strong>Şekil 14: Hesap Bilgilerinin Alınması</strong></p> <p>İSTEK:<br>
Müşteri rızası tesis edilmiş kullanıcı için HBHS API erişim adresinden HHS’ye erişilebilir hesap bilgilerini GET isteği ile sorgular:</p> <ul><li>RizaDurumu “Yetki Kullanıldı” ise işleme başlanır. RizaDurumu farklı bir değerde ise “TR.OHVPS.Resource.ConsentMismatch” hatasının iletilmesi gerekir.</li> <li>GET verisinin modele göre kontrolü yapılır (Örneğin: Alan kontrolleri)</li></ul> <p>GET verisinin mantıksal kontrolleri yapılır.</p> <h2 id="_7-6-adim-3-1-ve-3-2-hesap-bilgilerinin-sorgulanması"><a href="#_7-6-adim-3-1-ve-3-2-hesap-bilgilerinin-sorgulanması" class="header-anchor">#</a> 7.6 ADIM 3.1 ve 3.2: Hesap Bilgilerinin Sorgulanması</h2> <p><strong>GET /hesaplar ve GET /hesaplar/{hspRef}</strong></p> <p>Bu erişim noktalarından tüm hesapların veya belirli bir hesabın bilgilerinin sorgulanır. Hesap bilgisi için daha önce tanımlanmış izin türüne göre (Temel Hesap Bilgisi veya Detaylı Hesap Bilgisi) yanıtında dönülen HesapBilgileri nesnesinin içeriği değişir.  Tablo 15’te HesapBilgileri nesnesinin içeriği verilmiştir.</p> <p>Hesap Bilgisi Sorgu Örneği (Tüm Hesaplar) =  /hesaplar<br>
Hesap Bilgisi Sorgu Örneği (Belirli Bir Hesap) =  /hesaplar/{hspRef}<br>
İşlem Sorgu Örneği (Belirli Bir Hesap) =  /hesaplar?
syfKytSayi=25&amp;
syfNo=1&amp;
srlmKrtr= hspRef &amp;
srlmYon=A</p> <p><strong>Tablo 14: Hesap Bilgileri Sorgulama İsteği Sorgu Parametreleri</strong></p> <table><thead><tr><th>Alan Adı</th> <th>Parametre Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th> <th>HHS tarafından yapılması gereken kontrol ve işlemler</th></tr></thead> <tbody><tr><td>Sayfa Başına İstenen Kayıt Sayısı</td> <td>syfKytSayi</td> <td>N3</td> <td>İ</td> <td>Sayfa başına istenen kayıt sayısı. Bu alanda iletilen değer 100’den büyük olamaz.</td> <td>Bu veri gönderildiği durumda, HHS listesini bu sayı kadar gruplandırarak gönderir. Bu veri gönderilmediğinde sayfadaki kayıt sayısı 100 olarak kullanılır.</td></tr> <tr><td>İstenen Sayfa Numarası</td> <td>syfNo</td> <td>N3</td> <td>İ</td> <td>Cevapta dönecek sayfa numarası 1’den başlayarak artan değerlerle iletilmelidir.</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu sayfadaki kayıtları gönderir. Gönderilmediğinde, HHS ilk sayfadaki kayıtları gönderir.</td></tr> <tr><td>Sıralama Kriteri</td> <td>srlmKrtr</td> <td>AN3..50</td> <td>İ</td> <td>Cevapta dönülecek kayıtların sıralama kriterini belirtir. Alabileceği değerler: { “hspRef”}</td> <td>Bu veri gönderildiği durumda, HHS listesini bu kritere göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama kriterini hspRef olarak belirler.</td></tr> <tr><td>Sıralama Yönü</td> <td>srlmYon</td> <td>AN1</td> <td>İ</td> <td>Cevapta dönülecek işlemlerin sıralama yönünü belirtir. Alabileceği değerler:  A: Azalan değerle sıralama Y: Artan değerle sıralama {“A”,”Y”}</td> <td>Bu veri gönderildiği durumda, HHS listesini bu yöne göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama yönünü Azalan olarak belirler.</td></tr></tbody></table> <p><strong>Tablo 15: “HesapBilgileri” nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>Rıza No</td> <td>rizaNo</td> <td>AN1..128</td> <td>Z</td> <td>HesapBilgisiRızası nesnesinin oluşturulması esnasında HHS kaynak sunucusu tarafından atanan biricik tanımlayıcı</td></tr> <tr><td>Hesap Temel</td> <td>hspTml</td> <td>Kompleks: HesapTemel</td> <td>Z</td> <td>Temel Hesap Bilgileri (Temel Hesap Bilgisi varsayılan izin türü olduğundan Hesap Temel nesnesi zorunlu olarak yanıtta bulunur)</td></tr> <tr><td>&gt; Hesap Referansı</td> <td>hspRef</td> <td>AN5..40</td> <td>Z</td> <td>HHS tarafından hesap için atanan biricik tanımlıyıcıdır (uuid). YÖS bazında farklılaşması gerekmez.</td></tr> <tr><td>&gt; Hesap Numarası</td> <td>hspNo</td> <td>AN26</td> <td>K</td> <td>Eğer varsa ödeme hesabına ait IBAN bilgisi</td></tr> <tr><td>&gt; Hesap Sahibi Unvanı</td> <td>hspShb</td> <td>AN3..140</td> <td>Z</td> <td>Hesap sahibi ya da hesap sahiplerinin ad-soyadı, ticari unvanı</td></tr> <tr><td>&gt; Şube Adı</td> <td>subeAdi</td> <td>AN3..50</td> <td>K</td> <td>Eğer varsa ödeme hesabının bağlı olduğu şubenin adı</td></tr> <tr><td>&gt; Kısa Ad</td> <td>kisaAd</td> <td>AN3..50</td> <td>K</td> <td>Eğer hesap sahibi hesaba ait bir ad tanımladıysa, tanımlanan hesap adı</td></tr> <tr><td>&gt; Para Birimi</td> <td>prBrm</td> <td>AN3</td> <td>Z</td> <td>Para Birimi.</td></tr> <tr><td>&gt; Hesap Türü</td> <td>hspTur</td> <td>AN1</td> <td>Z</td> <td>Hesabın türü (bireysel veya ticari). TR.OHVPS.DataCode.HspTur sırali veri değerlerinden birini alır.</td></tr> <tr><td>&gt; Hesap Tipi</td> <td>hspTip</td> <td>AN1..32</td> <td>Z</td> <td>Hesabın tipi (VADESİZ, KREDİLİ vb.).TR.OHVPS.DataCode.HspTip sıralı veri değerlerinden birini alır.</td></tr> <tr><td>&gt;Hesap Ürün Adı</td> <td>hspUrunAdi</td> <td>AN1..140</td> <td>İ</td> <td>HHS tarafından atanmış olan ürün adı bilgisidir. HBHS tarafından ÖHK’ya gösterilmesi kullanım kolaylığı sağlayacaktır.</td></tr> <tr><td>&gt; Hesap Durumu</td> <td>hspDrm</td> <td>AN5..50</td> <td>Z</td> <td>Hesabın durumunu belirtir. TR.OHVPS.DataCode.HspDrm sıralı veri türlerinden birini alır.</td></tr> <tr><td>Hesap Detay</td> <td>hspDty</td> <td>Kompleks: HesapDetay</td> <td>K</td> <td>Detay Hesap Bilgileri (Temel Hesap Bilgisine ek olarak Detay Hesap Bilgisi izin türü de seçilmişse Hesap Detay nesnesi koşullu olarak yanıtta bulunur)</td></tr> <tr><td>&gt; Açılış Tarihi</td> <td>hspAclsTrh</td> <td>ISODateTime</td> <td>Z</td> <td>Belirtilen hesabın açılış tarihi.</td></tr></tbody></table> <h2 id="_7-7-adim-3-3-ve-3-4-hesap-bakiyesinin-sorgulanması"><a href="#_7-7-adim-3-3-ve-3-4-hesap-bakiyesinin-sorgulanması" class="header-anchor">#</a> 7.7 ADIM 3.3 ve 3.4: Hesap Bakiyesinin Sorgulanması</h2> <p><strong>GET /bakiye ve GET /hesaplar/{hspRef}/bakiye</strong><br>
Bu erişim noktalarından tüm hesapların veya belirli bir hesabın bakiyesi sorgulanır.<br>
İstek çağrısına dönülen “BakiyeBilgileri” nesnesi Tablo 17’de verilmiştir.</p> <p>Hesap bakiyelerinin gösterilmesi sırasında aşağıda verilen örnekler gözönünde bulundurulmalıdır.</p> <p>Örnek 1 : ÖHK <strong>Hesap Bakiye Tutarı</strong> 0 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL. ÖHK 1000 TL para çıkışı gerçekleştirdi. Bakiye API'si yanıtı içerisinde iletilen <strong>Kredi Dahil Göstergesi</strong> 0 değerini içeriyorsa, <strong>Hesap Bakiye Tutarı</strong> -1000 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL olmalıdır.</p> <p>Örnek 2 : ÖHK <strong>Hesap Bakiye Tutarı</strong> 0 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL. ÖHK 1000 TL para çıkışı gerçekleştirdi. Bakiye API'si yanıtı içerisinde iletilen <strong>Kredi Dahil Göstergesi</strong> 1 değerini içeriyorsa, <strong>Hesap Bakiye Tutarı</strong> 2000 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL olmalıdır.</p> <p>Örnek 3 : ÖHK <strong>Hesap Bakiye Tutarı</strong> 1000 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL. ÖHK 1000 TL para çıkışı gerçekleştirdi. Bakiye API'si yanıtı içerisinde iletilen <strong>Kredi Dahil Göstergesi</strong> 0 değerini içeriyorsa, <strong>Hesap Bakiye Tutarı</strong> 0 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL olmalıdır.</p> <p>Örnek 4 : ÖHK <strong>Hesap Bakiye Tutarı</strong> 1000 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL. ÖHK 1000 TL para çıkışı gerçekleştirdi. Bakiye API'si yanıtı içerisinde iletilen <strong>Kredi Dahil Göstergesi</strong> 1 değerini içeriyorsa, <strong>Hesap Bakiye Tutarı</strong> 3000 TL, <strong>Kredili Mevduat Hesabı Bakiyesi</strong> 3000 TL olmalıdır.</p> <p>İşlem Sorgu Örneği (Belirli Bir Hesap)=  /bakiye?
syfKytSayi=25&amp;
syfNo=1&amp;
srlmKrtr= hspRef &amp;
srlmYon=A</p> <p><strong>Tablo 16: “BakiyeBilgileri” Sorgulama İsteği Sorgu Parametreleri</strong></p> <table><thead><tr><th>Alan Adı</th> <th>Parametre Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th> <th>HHS tarafından yapılması gereken kontrol ve işlemler</th></tr></thead> <tbody><tr><td>Sayfa Başına İstenen Kayıt Sayısı</td> <td>syfKytSayi</td> <td>N3</td> <td>İ</td> <td>Sayfa başına istenen kayıt sayısı. Bu alanda iletilen değer 100’den büyük olamaz.</td> <td>Bu veri gönderildiği durumda, HHS listesini bu sayı kadar gruplandırarak gönderir. Bu veri gönderilmediğinde sayfadaki kayıt sayısı 100 olarak kullanılır.</td></tr> <tr><td>İstenen Sayfa Numarasi</td> <td>syfNo</td> <td>N3</td> <td>İ</td> <td>Cevapta dönecek sayfa numarası 1’den başlayarak artan değerlerle iletilmelidir.</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu sayfadaki kayıtları gönderir. Gönderilmediğinde, HHS ilk sayfadaki kayıtları gönderir.</td></tr> <tr><td>Sıralama Kriteri</td> <td>srlmKrtr</td> <td>AN3..50</td> <td>İ</td> <td>Cevapta dönülecek kayıtların sıralama kriterini belirtir. Alabileceği değerler: { “hspRef”}</td> <td>Bu veri gönderildiği durumda, HHS listesini bu kritere göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama kriterini hspRef olarak belirler.</td></tr> <tr><td>Sıralama Yönü</td> <td>srlmYon</td> <td>AN1</td> <td>İ</td> <td>Cevapta dönülecek işlemlerin sıralama yönünü belirtir. Alabileceği değerler:  A: Azalan değerle sıralama Y: Artan değerle sıralama {“A”,”Y”}</td> <td>Bu veri gönderildiği durumda, HHS listesini bu yöne göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama yönünü Azalan olarak belirler.</td></tr></tbody></table> <p><strong>Tablo 17: “BakiyeBilgileri” nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>Hesap Referansı</td> <td>hspRef</td> <td>AN5..40</td> <td>Z</td> <td>HHS tarafından hesap için atanan biricik tanımlıyıcıdır (uuid). YÖS bazında farklılaşması gerekmez.</td></tr> <tr><td>Bakiye</td> <td>bky</td> <td>Kompleks:Bakiye</td> <td>Z</td> <td></td></tr> <tr><td>&gt; Hesap Bakiye Tutarı</td> <td>bkyTtr</td> <td>AN1..25</td> <td>Z</td> <td>Hesabın bakiyesi. Bloke tutar düşülmeden iletilmelidir. <br> Tutar alanı regex patterni şu şekildedir:  '^-?\d{1,18}$|^-?\d{1,18}\.\d{1,5}$'</td></tr> <tr><td>&gt; Blokeli Tutar</td> <td>blkTtr</td> <td>AN1..24</td> <td>K</td> <td>Varsa hesapta blokeli tutar bilgisi.   <br> Tutar alanı regex patterni şu şekildedir: '^\d{1,18}$|^\d{1,18}\.\d{1,5}$'</td></tr> <tr><td>&gt; Para Birimi</td> <td>prBrm</td> <td>AN3</td> <td>Z</td> <td>Para birimi.</td></tr> <tr><td>&gt; Bakiye İletilme Zamanı</td> <td>bkyZmn</td> <td>ISODateTime</td> <td>Z</td> <td>Bakiyenin iletildiği zaman bilgisi.</td></tr> <tr><td>&gt; KrediliHesap</td> <td>krdHsp</td> <td>Kompleks: KrediliHesap</td> <td>K</td> <td></td></tr> <tr><td>&gt;&gt; Kredili Mevduat Hesabı Bakiyesi</td> <td>kulKrdTtr</td> <td>AN1..24</td> <td>Z</td> <td>Kredili mevduat tutarı. Kredili bir hesap ise zorunlu. <br> Tutar alanı regex patterni şu şekildedir: '^\d{1,18}$|^\d{1,18}\.\d{1,5}$'</td></tr> <tr><td>&gt;&gt; Kredi Dahil Göstergesi</td> <td>krdDhlGstr</td> <td>AN1</td> <td>Z</td> <td>Kredili bir hesap ise zorunlu. Bakiye tutarının kredi tutarı dahil edilerek ya da edilmeden iletildiğini gösterir. <br> 0: Kredi tutarı dahil edilmeden bakiye bilgisi iletilmesi durumu <br> 1: Kredi tutarı dahil edilerek bakiye bilgisi iletilmesi durumu</td></tr></tbody></table> <h2 id="_7-8-adim-3-5-ve-3-6-islemlerin-sorgulanması"><a href="#_7-8-adim-3-5-ve-3-6-islemlerin-sorgulanması" class="header-anchor">#</a> 7.8 ADIM 3.5 ve 3.6: İşlemlerin Sorgulanması</h2> <p><strong>GET /hesaplar/{hspRef}/islemler</strong></p> <p>Belirli bir hesaba ilişkin işlem bilgileri Tablo 1’daki istek parametrelerine göre sorgulanır.<br>
İşlem bilgisi için daha önce tanımlanmış izin türüne göre yanıtta dönen IslemBilgileri nesnesinin (Temel İşlem Bilgisi veya Temel İşlem Bilgisi ve Detaylı İşlem Bilgisi) içeriği değişir.<br>
İşlemler servisi hem ÖHK’nın talebi ile YÖS uygulaması üzerinden çağrılabileceği gibi, YÖS’ün ÖHK’sız başlatabileceği otomatik çağrıları ile de yanıt dönebilmektedir.<br>
HHS, işlemin sistemsel yapılıp yapılmadığını, istek parametreleri içerisinde yer alan PSU-Initiated parametresi ile anlar. Bu parametre “E” ise ÖHK’lı, “H” ise sistemsel yapılmış bir sorgu anlamına gelmektedir.
ÖHK’nın başlattığı sorgular için HHS tarafından belirlenen üst rate limitler dahilinde çağrım yapılabilir.<br>
YÖS, otomatik yapacağı sorgularda;</p> <ul><li>Bireysel ÖHK’lar için hesap bazında günde en fazla 4 adet başarı ile sonuçlanan sorgulama yapabilir.</li> <li>Kurumsal ÖHK’lar için hesap bazında saatte en fazla 12 adet başarı ile sonuçlanan sorgulama yapabilir.</li></ul> <p>HHS, tutacağı sayaç bilgisi ile bu sayıları kontrol ederek daha fazla sorgulama yapılmasına izin vermeyebilir.</p> <p>Aynı istek parametreleri ile yapılan sorgu sonucunda dönecek toplam kayıt sayısı 100’ü aştığında, sayfalama yöntemi ile HHS’nin cevap dönmesi beklenmektedir.  Her bir sayfa için işlemler servisi tekrar çağrılsa da, bu çağrım HHS’nin tuttuğu sayaç değerini arttırmaz. HHS’nin tutacağı sayaçın kontrol parametreleri YÖS kodu, hesap numarası ya da referansı olmalıdır. Sayfa no parametresi varsa ve 1'den büyük ise işlem sayacını arttırmamalıdır.</p> <p>ÖHK’nın YÖS uygulaması üzerinden tetiklediği işlemlerde ise;
bireysel ÖHK’lar  için en fazla 1 aylık,
kurumsal ÖHK’lar için ise en fazla 1 haftalık bir pencere aralığında sorgulama yapılabilir.</p> <p>YÖS, otomatik yapacağı sorgularda hem bireysel hem de kurumsal ÖHK’lar için 24 saatlik bir pencere aralığında sorgulama yapabilir.</p> <p>Hesap kapalı olduğu durumda hesap hareketlerini iletmek istemeyen HHS'lerin <strong>TR.OHVPS.Business.InvalidAccount</strong> hatası vermeleri beklenir.</p> <p>İşlem Sorgu Örneği (Belirli Bir Hesap)=  /hesaplar/{hspRef}/islemler?
hesapIslemBslTrh=2020-06-01T00:00:00+03:00&amp;
hesapIslemBtsTrh=2020-06-02T23:59:59+03:00&amp;
minIslTtr=0&amp;
mksIslTtr=100000&amp;
brcAlc=A&amp;
syfKytSayi=25&amp;
syfNo=1&amp;
srlmKrtr= islGrckZaman &amp;
srlmYon=A</p> <p><strong>Tablo 18: İşlem Listesi Sorgulama İsteği Sorgu Parametreleri</strong></p> <table><thead><tr><th>Alan Adı</th> <th>Parametre Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th> <th>HHS tarafından yapılması gereken kontrol ve işlemler</th></tr></thead> <tbody><tr><td>İşlem Sorgulama Başlangıç Zamanı</td> <td>hesapIslemBslTrh</td> <td>ISODateTime</td> <td>Z</td> <td>Sorgulanacak işlemlerin başlangıç tarihi.</td> <td>HHS işlemler listesi dönüşünü bu kritere göre filtreleyerek iletmek zorundadır.<br><br>ÖHK tarafından tetiklenen sorgularda;hesapIslemBslTrh ve hesapIslemBtsTrh arası fark bireysel ÖHK’lar için en fazla 1 ay,kurumsal ÖHK’lar için ise en fazla 1 hafta olabilir.<br><br>YÖS tarafından sistemsel yapılan sorgulamalarda hem bireysel, hem de kurumsal ÖHK’lar için;son 24 saat sorgulanabilir. Bu yüzden hesapIslemBtsTrh-24 saat’ten daha uzun bir aralık sorgulanamaz olmalıdır.<br><br>İstek başlığında yer alan PSU-Initiated alanı “E” ise ÖHK’lı, “H” ise sistemsel yapılmış bir sorgu anlamına gelmektedir.</td></tr> <tr><td>İşlem Sorgulama Bitiş Zamanı</td> <td>hesapIslemBtsTrh</td> <td>ISODateTime</td> <td>Z</td> <td>Sorgulanacak işlemlerin bitiş tarihi.</td> <td>HHS işlemler listesi dönüşünü bu kritere göre filtreleyerek iletmek zorundadır.<br>YÖS tarafından sistemsel yapılan sorgulamalarda hem bireysel, hem de kurumsal ÖHK’lar için;İleri vadeli işlem emirleri dahil olmadığı için; İşlem Sorgulama Bitiş Zamanı, her zaman, sorgulama zaman damgasını iletecek şekilde (datetime (now)) iletilmelidir.</td></tr> <tr><td>En Düşük İşlem Tutarı</td> <td>minIslTtr</td> <td>AN1..24</td> <td>İ</td> <td>Sorgulanacak işlemlerin alabileceği en düşük işlem tutarı. <br> <br> Tutar alanı regex patterni şu şekildedir: '^\d{1,18}$|^\d{1,18}\.\d{1,5}$'</td> <td>Bu veri gönderildiği durumda HHS işlemler listesi dönüşünü bu kritere göre filtreleyerek iletmek zorundadır.</td></tr> <tr><td>En Yüksek İşlem Tutarı</td> <td>mksIslTtr</td> <td>AN1..24</td> <td>İ</td> <td>Sorgulanacak işlemlerin alabileceği en yüksek işlem tutarı.  <br> Tutar alanı regex patterni şu şekildedir: '^\d{1,18}$|^\d{1,18}\.\d{1,5}$'</td> <td>Bu veri gönderildiği durumda HHS işlemler listesi dönüşünü bu kritere göre filtreleyerek iletmek zorundadır.</td></tr> <tr><td>Borç Alacak Göstergesi</td> <td>brcAlc</td> <td>AN1</td> <td>İ</td> <td>TR.OHVPS.DataCode.BrcAlc sıralı veri tipi değerlerinden birini alır. Sorgulanacak işlemlerin borç / alacak kriteri B: Hesaba borç yaratan işlem.A: Hesaba alacak yaratan işlem.{“B”,”A”}</td> <td>Bu veri gönderildiği durumda HHS işlemler listesi dönüşünü bu kritere göre filtreleyerek iletmek zorundadır.</td></tr> <tr><td>Sayfa Başına İstenen Kayıt Sayısı</td> <td>syfKytSayi</td> <td>N3</td> <td>İ</td> <td>Sayfa başına istenen kayıt sayısı. Bu alanda iletilen değer 100’den büyük olamaz.</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu sayı kadar gruplandırarak gönderir. Bu veri gönderilmediğinde sayfadaki kayıt sayısı 100 olarak kullanılır.</td></tr> <tr><td>İstenen Sayfa Numarasi</td> <td>syfNo</td> <td>N3</td> <td>İ</td> <td>Cevapta dönecek sayfa numarası 1’den başlayarak artan değerlerle iletilmelidir.</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu sayfadaki kayıtları gönderir. Gönderilmediğinde, HHS ilk sayfadaki kayıtları gönderir.</td></tr> <tr><td>Sıralama Kriteri</td> <td>srlmKrtr</td> <td>AN3..50</td> <td>İ</td> <td>Cevapta dönülecek işlemlerin sıralama kriterini belirtir. Alabileceği değerler: {“islGrckZaman”}</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu kritere göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama kriterini islGrckZaman olarak belirler.</td></tr> <tr><td>Sıralama Yönü</td> <td>srlmYon</td> <td>AN1</td> <td>İ</td> <td>Cevapta dönülecek işlemlerin sıralama yönünü belirtir. Alabileceği değerler: A: Azalan değerle sıralama Y: Artan değerle sıralama {“A”,”Y”}</td> <td>Bu veri gönderildiği durumda, HHS işlemler listesini bu yöne göre sıralayarak gönderir. Gönderilmediğinde, HHS sıralama yönünü Azalan olarak belirler.</td></tr></tbody></table> <p><strong>Tablo 19: “IslemBilgileri” nesnesi</strong></p> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format</th> <th>Zorunlu / Koşullu /  İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>Hesap Referans Numarası</td> <td>hspRef</td> <td>AN5..40</td> <td>Z</td> <td>HHS tarafından hesap için atanan biricik tanımlıyıcıdır (uuid). YÖS bazında farklılaşması gerekmez.</td></tr> <tr><td>Islemler</td> <td>isller</td> <td>Kompleks:Islem[Array]</td> <td>K</td> <td>Hesaba ilişkin hareketler varsa İşlemler nesnesi dizisi olarak dönülür. İşlemler nesnesi Temel İşlem Bilgileri ve Detay İşlem Bilgileri nesnesinden meydana gelir. İzin türü varsayılan olarak Temel İşlem Bilgilerini içerir. Detay İşlem Bilgileri izin türü de seçildi ise Temel İşlem Bilgilerine ek olarak Detay İşlem Bilgileri de gönderilir.</td></tr> <tr><td>&gt; Temel İşlem Bilgileri</td> <td>islTml</td> <td>Kompleks:IslemTemel</td> <td>Z</td> <td>Temel İşlem Bilgileri varsayılan olarak dönülür.</td></tr> <tr><td>&gt;&gt; İşlem Numarası</td> <td>islNo</td> <td>AN3..50</td> <td>Z</td> <td>Hesap hareketinin oluşturulması sırasında atanan ve borç (veya alacak) hareketini tekilleştiren HHS bazında tekil tanımlayıcıdır. Bu değer tek başına tekil olabileceği gibi birden fazla değerin bir araya getirilmesiyle de tekilliği sağlanmış olabilir. Bu değerin en azından hesap numarası (hesNo) bazında tekil olması beklenir. Genellikle kullanılan örnekleri; Instance_Id, Transaction_Id, Transaction_Num, Transaction_TimeStamp,dekont numarası</td></tr> <tr><td>&gt;&gt; İşlem Referans Numarası</td> <td>refNo</td> <td>AN3..50</td> <td>Z</td> <td>İşlemi uçtan uca tanımlayan tekil tanımlayıcıdır. Borç ve alacak hareketinden oluşan bir veya birden fazla işlemler bütünü için atanmış olan ve bu bütünü tekilleştiren (bir biri ile ilişkisini tutan) değerdir.Bu değer hem YÖS’ten gelen değer olabilir (ödeme işlemlerinde kullanılan kkodRef ya da refBlg alanı) hem de HHS içinde takip edilmek için üretilmiş bir değer olabilir. HHS sisteminde 2 değerin de bulunması durumunda;refNo alanını doldurmak için, HHS’nin YÖS’ten gelen değere öncelik vermesi beklenmektedir. YÖS’ten gelen veri örneği: Sipariş Numarası, Fatura Numarası, Karekod Referansı vb. HHS’te üretilen veri örneği: Masraflı havale işleminde hem havale işleminin hem de masraf işleminin aynı referans numarasına sahip olması da örnek olarak gösterilebilir.</td></tr> <tr><td>&gt;&gt; İşlem Tutarı</td> <td>islTtr</td> <td>AN1..24</td> <td>Z</td> <td>İşlem tutarı.  <br> Tutar alanı regex patterni şu şekildedir: '^\d{1,18}$|^\d{1,18}\.\d{1,5}$'</td></tr> <tr><td>&gt;&gt; Para Birimi</td> <td>prBrm</td> <td>AN3</td> <td>Z</td> <td>Para birimi.</td></tr> <tr><td>&gt;&gt; İşlem Gerçekleşme Zamanı</td> <td>islGrckZaman</td> <td>ISODateTime</td> <td>Z</td> <td>İşlemin gerçekleşme zamanı.</td></tr> <tr><td>&gt;&gt; İşlem Kanalı</td> <td>kanal</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.OdemeKaynak sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt;&gt; Borçlandırma Alacaklandırma Göstergesi</td> <td>brcAlc</td> <td>AN1</td> <td>Z</td> <td>TR.OHVPS.DataCode.BrcAlc sıralı veri türü değerlerinden birini alır. İşlemin hesabı borç ya da alacaklandırdığı bilgisidir.</td></tr> <tr><td>&gt;&gt; İşlem Türü</td> <td>islTur</td> <td>AN3..50</td> <td>Z</td> <td>HHS’nin işleme ait ilişkilendirdiği işlem türü değeri. TR.OHVPS.DataCode.IslemTuru sıralı veri türü değerlerinden birini alır.</td></tr> <tr><td>&gt;&gt; İşlem Amacı</td> <td>islAmc</td> <td>AN2</td> <td>Z</td> <td>TR.OHVPS.DataCode.IslemAmaci sırali veri değerlerinden birini alır.<br><br>Karekod akışında, FAST Karekod Veri Organizasyonundaki 62-08: alanında tanımlı Ödeme Amacı verisi kullanılır.</td></tr> <tr><td>&gt;&gt; Ödeme Sistemi No</td> <td>odmStmNo</td> <td>AN10..50</td> <td>K</td> <td>Ödeme başarılı başlatıldıysa, ödemenin başlatıldığı sistemdeki referans numarası. Gerektiğinde ilgili ödeme sisteminde/HHS’de söz konusu ödemeye karşılık gelen mesajla bağlantı kurmada kullanılır. <br> Ödeme Hizmeti kullanıcısına işlemin takibi için gösterilebilir. <br>İşlemin yönlendirildiği ödeme sistemi FAST ya da PÖS ise sistemdeki ilgili mesajın Tarih, GönderenKatilimKodu ve SorguNumarasi değerlerinin birleşiminden oluşur. Bu 3 alan mevcutta kullanıldığı formatta aralarına dikey çizgi (Unicode U+2223) işareti koyularak, birleştirmeli ve iletilmelidir. Örn : Tarih|GönderenKatilimKodu|SorguNumarasi  <br>Ödeme Havale/Virman işlemi ise HHS’nin üretmiş olduğu havale/virman numarasını içerir. Buradaki format da Tarih|GönderenKatilimKodu|Havale-virman numarası şeklinde olmalıdır.</td></tr> <tr><td>&gt; Detay İşlem Bilgileri</td> <td>islDty</td> <td>Kompleks: IslemDetay</td> <td>K</td> <td>Detay İşlem Bilgileri dizi olarak gönderilmelidir.</td></tr> <tr><td>&gt;&gt; İşlem Açıklaması</td> <td>islAcklm</td> <td>AN1..150</td> <td>Z</td> <td>HHS tarafından atanan işlem açıklaması.HHS kendi işlem hareketlerine yansıttığı açıklamayı buraya yansıtmalıdır.</td></tr> <tr><td>&gt;&gt; Karşı Taraf</td> <td>krsTrf</td> <td>Kompleks:  KarsiTaraf</td> <td>K</td> <td>Kullanımı işlem bazında değişmektedir. Örnek: FAST işleminde karşı taraf alıcının bilgileridir. Vergi ödemesinde kurum IBAN bilgisi müşteriye gösterilemeyebileceğinden bu alanın boş gelmesi HHS insiyatifindedir.</td></tr> <tr><td>&gt;&gt;&gt; Karşı Maskeli IBAN</td> <td>krsMskIBAN</td> <td>AN26</td> <td>K</td> <td>İlgili hesap hareketinin karşı tarafının maskeli IBAN bilgisi.</td></tr> <tr><td>&gt;&gt;&gt; Karşı Maskeli Unvan</td> <td>krsMskUnvan</td> <td>AN3..140</td> <td>K</td> <td>İlgili hesap hareketinin karşı tarafının maskeli ad-soyad ya da ticari unvan bilgisi.</td></tr></tbody></table> <h2 id="_7-9healthcheck-api"><a href="#_7-9healthcheck-api" class="header-anchor">#</a> 7.9	Healthcheck API</h2> <p>GET /health</p> <p>HHS’lerin sunacağı bu servis, düzenli olarak BKM tarafından çağırılarak servislerin ayakta olup olmadıklarının kontrolünün sağlanması planlanmaktadır</p> <p>Başarılı yanıtta Http 200 kodu dönülmelidir.</p> <h3 id="basarılı-yanıt-2"><a href="#basarılı-yanıt-2" class="header-anchor">#</a> Başarılı Yanıt:</h3> <table><thead><tr><th>Alan Adı</th> <th>JSON Alan Adı</th> <th>Format: Veri modeli İsmi</th> <th>Zorunlu / Koşullu / İsteğe bağlı</th> <th>Açıklama</th></tr></thead> <tbody><tr><td>status</td> <td>status</td> <td>AN2..20</td> <td>Z</td> <td>“UP”, “DOWN” değerlerini alabilir</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1.0.2/contents/odeme-emri-baslatma-hizmeti.html" class="prev">
        6. Ödeme Emri Başlatma Hizmeti
      </a></span> <span class="next"><a href="/v1.0.2/contents/hhs-yos-api.html">
        8. HHS ve YÖS API
      </a>
      →
    </span></p></div> <div class="footer-wrapper"><footer class="page-edit footer"><div class="footer-info"><p style="padding-right:15px;">© Tüm hakları saklıdır.</p></div></footer></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.235406e1.js" defer></script><script src="/assets/js/9.97cddfb1.js" defer></script><script src="/assets/js/2.60a0bf64.js" defer></script><script src="/assets/js/6.f1be765e.js" defer></script>
  </body>
</html>
