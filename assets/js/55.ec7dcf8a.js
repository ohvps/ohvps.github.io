(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{546:function(a,e,i){a.exports=i.p+"assets/img/HhsYosApiMimarisiv2.2006af35.png"},653:function(a,e,i){"use strict";i.r(e);var r=i(15),l=Object(r.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h2",{attrs:{id:"ek-1-istek-cevap-mesajlarında-kullanılacak-nesne-yapıları"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-1-istek-cevap-mesajlarında-kullanılacak-nesne-yapıları"}},[a._v("#")]),a._v(" EK-1: İstek/Cevap Mesajlarında Kullanılacak Nesne Yapıları")]),a._v(" "),e("p",[a._v("Açık Bankacılık simülatör uygulaması üzerinde swagger dökümanlarının güncel sürümlerine erişim sağlanabilir.")]),a._v(" "),e("h2",{attrs:{id:"ek-2-sıralı-veri-turleri"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-2-sıralı-veri-turleri"}},[a._v("#")]),a._v(" EK-2: Sıralı Veri Türleri")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Kod")]),a._v(" "),e("th",[a._v("Açıklama")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("TR.OHVPS.DataCode.KimlikTur")]),a._v(" "),e("td",[a._v("Kod, Tip, Format"),e("br"),a._v("K , TCKN , N11"),e("br"),a._v("M , MNO , AN1..30 (HHS’ye özel bireysel veya kurum müşteri numarası)"),e("br"),a._v("Y , YKN , N11"),e("br"),a._v("P , PNO , AN7..9")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.KurumKimlikTur")]),a._v(" "),e("td",[a._v("Kod, Tip, Format"),e("br"),a._v("K , TCKN , N11"),e("br"),a._v("M , MNO , AN1..30 (HHS’ye özel bireysel veya kurum müşteri numarası)"),e("br"),a._v("V , VKN , AN10")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.OhkTur")]),a._v(" "),e("td",[a._v("Kod:"),e("br"),a._v("B: Bireysel "),e("br"),a._v("K: Kurumsal")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.KolasTur")]),a._v(" "),e("td",[a._v("Müşterinin sorgulama istediği Kolay Adres Tipi değeridir. Alabileceği değerler BKM “Kolay Adresleme Sistemi Uygulama Kuralları” belgesinde tanımlıdır:"),e("br"),a._v("T: Telefon Numarası"),e("br"),a._v("E: E-Posta"),e("br"),a._v("K: TCKN"),e("br"),a._v("V: VKN"),e("br"),a._v("Y: YKN"),e("br"),a._v("P: Pasaport Numarası")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.KareKodAksTur")]),a._v(" "),e("td",[a._v("Karekod Akış Türü Karekod ödemesinin hangi akışla gerçekleştirildiğini gösterir."),e("br"),a._v(" 01: FAST katılımcısından dinamik doğrulamalı hizmet alınan işyeri ödemesi"),e("br"),a._v("02: FAST katılımcısından statik doğrulamalı işyeri ödemesi"),e("br"),a._v("03: Kişiden kişiye ödemeler")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.OdemeKaynak")]),a._v(" "),e("td",[a._v("I: İnternet bankacılığından gönderilen ödemelerde kullanılır."),e("br"),a._v("A: Otomatik para makineleri (ATM) ile gönderilen ödemelerde kullanılır."),e("br"),a._v("T: Telefon bankacılığı ile gönderilen ödemelerde kullanılır."),e("br"),a._v("K: Kiosklar aracılığıyla gönderilen ödemelerde kullanılır."),e("br"),a._v("S: Şubeden girilen ödemelerde kullanılır."),e("br"),a._v("M: Mobil uygulamadan gönderilen ödemelerde kullanılır."),e("br"),a._v("D: Yukarıdakiler dışındaki ödeme kaynaklarından gönderilen ödemelerde kullanılır."),e("br"),a._v(" O: Açık bankacılık aracılığı ile gönderilen ödemelerde kullanılır."),e("br")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.OdemeAmaci")]),a._v(" "),e("td",[a._v("Ödemenin Amacına yönelik olarak aşağıdaki değerlerden birini alır:"),e("br"),a._v("01: Konut Kirası Ödemesi"),e("br"),a._v("02: İş yeri Kirası Ödemesi"),e("br"),a._v("03: Diğer Kira Ödemesi"),e("br"),a._v("04: E-Ticaret Ödemesi: Elektronik ticaret işlem amaçlı aktarımlar"),e("br"),a._v("05: Çalışan Ödemesi: Maaş, harcırah, prim gibi çalışan ödemeleri"),e("br"),a._v("06: Ticari ödeme: Ticari işletmelerin birbirlerine, kendi hesaplarına veya müşterilerine ödemeleri, borç, ithalat, ihracat, şirket satın alma, vb. kapsamında ödemeler"),e("br"),a._v("07: Bireysel Ödeme: Özel amaçlı (aile bireylerine, hediye, bağış, borç, alışveriş vs.) ödemeler"),e("br"),a._v("08: Yatırım: Mevduat, menkul kıymet, döviz, gayrı menkul, taşıt, varlık alımı, temettü ödeme, tahsilat vb. gibi yatırım amaçlı ödemeler"),e("br"),a._v("09: Finansal: Kredi, depo, repo, türev, finansal varlık alım/satımı vb. ödemeler"),e("br"),a._v("10: Eğitim ödemesi"),e("br"),a._v("11: Aidat ödemesi")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.OdemeDurumu")]),a._v(" "),e("td",[a._v("Ödemenin durumunu gösterir. Alabileceği değerler:"),e("br"),a._v("01: Gerçekleşti (Ödeme ilgili ödeme sistemine iletildi ve alıcı hesabına ulaştı.) "),e("br"),a._v("02: Gönderildi (Ödeme ilgili ödeme sistemine iletildi ancak alıcı hesabına ulaştığına dair teyit alınmadı.)İşlemin son durumunun teyidi için YÖS sorgulama yapmalıdır."),e("br"),a._v("03- Gerçekleşmedi (Ödemenin ilgili ödeme sistemine işletiminde veya işlenmesi sırasında hata, zaman aşımı, sistemin gün sonu işlemlerine başlaması vb. durum oluştu ve ödeme gereçeklemedi veya iade edildi.)"),e("br"),a._v("04- Onayda bekliyor (Ödeme emri alındı. Çoklu onay akışının tamamlanması bekleniyor.)"),e("br"),a._v("05- İşleme Alındı ( Ödeme emri alındı. ) YÖS tarafından müşteriye gösterilmeyen bir koddur. Bu kod dönüldüğünde YÖS uygulamasında ÖHK’ya ödeme durumu 02-Gönderildi  olarak gösterilir. İşlemin son durumunun teyidi için YÖS sorgulama yapmalıdır.")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.IslemAmaci")]),a._v(" "),e("td",[a._v("Ödemenin Amacına yönelik olarak aşağıdaki değerlerden birini alır:"),e("br"),a._v("01: Konut Kirası Ödemesi"),e("br"),a._v("02: İş yeri Kirası Ödemesi"),e("br"),a._v("03: Diğer Kira Ödemesi"),e("br"),a._v("04: E-Ticaret Ödemesi: Elektronik ticaret işlem amaçlı aktarımlar"),e("br"),a._v("05: Çalışan Ödemesi: Maaş, harcırah, prim gibi çalışan ödemeleri"),e("br"),a._v("06: Ticari ödeme: Ticari işletmelerin birbirlerine, kendi hesaplarına veya müşterilerine ödemeleri, borç, ithalat, ihracat, şirket satın alma, vb. kapsamında ödemeler"),e("br"),a._v("07: Bireysel Ödeme: Özel amaçlı (aile bireylerine, hediye, bağış, borç, alışveriş vs.) ödemeler"),e("br"),a._v("08: Yatırım: Mevduat, menkul kıymet, döviz, gayrı menkul, taşıt, varlık alımı, temettü ödeme, tahsilat vb. gibi yatırım amaçlı ödemeler"),e("br"),a._v("09: Finansal: Kredi, depo, repo, türev, finansal varlık alım/satımı vb. ödemeler"),e("br"),a._v("10: Eğitim ödemesi"),e("br"),a._v("11: Aidat ödemesi"),e("br"),a._v("12: Diğer")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.RizaDurumu")]),a._v(" "),e("td",[a._v("B: Yetki Bekleniyor"),e("br"),a._v("Y: Yetkilendirildi"),e("br"),a._v("K: Yetki Kullanıldı"),e("br"),a._v("E: Yetki Ödeme Emrine Dönüştü"),e("br"),a._v("S: Yetki Sonlandırıldı"),e("br"),a._v("I :Yetki Iptal")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.GkdTur")]),a._v(" "),e("td",[a._v("GKD yapılmasını gerekli bulduğu durumda HHS, YÖS’ün belirlediği yöntemi dikkate alarak kendi belirlediği GKD yöntemini bildirir:"),e("br"),a._v("Y: Yönlendirmeli GKD"),e("br"),a._v("A: Ayrık GKD")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.RizaTip")]),a._v(" "),e("td",[a._v("H: Hesap Bilgisi Rızası"),e("br"),a._v("O: Ödeme Emri Rızası")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.IzinTur")]),a._v(" "),e("td",[a._v("01: Temel Hesap Bilgisi"),e("br"),a._v("02: Ayrıntılı Hesap Bilgisi"),e("br"),a._v("03: Bakiye Bilgisi"),e("br"),a._v("04: Temel İşlem (Hesap Hareketleri) Bilgisi"),e("br"),a._v("05: Ayrıntılı İşlem Bilgisi")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.OdemeSistemi")]),a._v(" "),e("td",[a._v("İşlemin yönlendirildiği Ödeme Sistemine göre aşağıdaki değerlerden birini alabilir:"),e("br"),a._v("H: Havale"),e("br"),a._v("F: FAST"),e("br"),a._v("E: EFT (PÖS)"),e("br"),a._v("değerlerinden birini alabilir.")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.IslemTuru")]),a._v(" "),e("td",[a._v("Hesap hareketleri (işlemler) sorgusunda dönülen İşlem Türü (islTur) parametresi aşağıdaki değerlerden birini alabilir:"),e("br"),a._v("HAVALE"),e("br"),a._v("EFT"),e("br"),a._v("FAST"),e("br"),a._v("PARA_YATIRMA"),e("br"),a._v("PARA_CEKME"),e("br"),a._v("YABANCI_PARA_HAVALE"),e("br"),a._v("YATIRIM_HESABINA_AKTARIM"),e("br"),a._v("YATIRIM_HESABINDAN_AKTARIM"),e("br"),a._v("KURUM_FATURA_ODEMESI"),e("br"),a._v("CEK"),e("br"),a._v("SENET"),e("br"),a._v("SIGORTA_ODEMESI"),e("br"),a._v("UCRET_KOMISYON_FAIZ"),e("br"),a._v("SGK_ODEMESI"),e("br"),a._v("VERGI_ODEMESI"),e("br"),a._v("DOVIZ_ALIM"),e("br"),a._v("DOVIZ_SATIM"),e("br"),a._v("KREDI_ODEMESI"),e("br"),a._v("KREDI_KULLANIM"),e("br"),a._v("KK_ODEMESI"),e("br"),a._v("KK_NAKIT_AVANS"),e("br"),a._v("SANS_OYUNU"),e("br"),a._v("UYE_ISYERI_ISLEMLERI"),e("br"),a._v("HGS_OGS_ISLEMLERI"),e("br"),a._v("DOGRUDAN_BORCLANDIRMA_SISTEMI"),e("br"),a._v("DIGER"),e("br")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.HspTur")]),a._v(" "),e("td",[a._v("Hesabın bireysel veya ticari nitelikte olduğunu belirtir:"),e("br"),a._v("B: Bireysel"),e("br"),a._v("T: Ticari")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.KolasHspTur")]),a._v(" "),e("td",[a._v("Hesabın bireysel veya ticari nitelikte olduğunu belirtir:"),e("br"),a._v("B: Bireysel"),e("br"),a._v("T: Ticari")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.HspTip")]),a._v(" "),e("td",[a._v("Hesap çeşidini belirtir:"),e("br"),a._v("VADESIZ"),e("br"),a._v("VADELI"),e("br"),a._v("KREDILI_MEVDUAT_HESABI"),e("br"),a._v("POS"),e("br"),a._v("CEK"),e("br"),a._v("YATIRIM")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.HspDrm")]),a._v(" "),e("td",[a._v("Hesabın durumunu belirtir:"),e("br"),a._v("AKTIF"),e("br"),a._v("PASIF"),e("br"),a._v("KAPALI")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.YetTip")]),a._v(" "),e("td",[a._v("Alabileceği değerlere göre hangi belirtecin döneceğine karar verilir."),e("br"),a._v("yet_kod"),e("br"),a._v("yenileme_belirteci")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.BrcAlc")]),a._v(" "),e("td",[a._v("İşlemin hesabı borçlandırdığı ya da alacaklandırdığı bilgisidir."),e("br"),a._v("B : Borç"),e("br"),a._v("A : Alacak")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.RizaIptDtyKod")]),a._v(" "),e("td",[a._v("‘01’ :Yeni Rıza Talebi ile İptal"),e("br"),a._v("‘02’ :Kullanıcı İsteği ile HHS üzerinden İptal"),e("br"),a._v("‘03’ :Kullanıcı İsteği ile YÖS üzerinden İptal"),e("br"),a._v("‘04’ :Süre Aşımı : Yetki Bekleniyor"),e("br"),a._v("‘05’ :Süre Aşımı : Yetkilendirildi"),e("br"),a._v("‘06’ :Süre Aşımı : Yetki Ödemeye Dönüşmedi"),e("br"),a._v("‘07’ :GKD iptali : Aynı rıza no ile mükerrer çağrımı"),e("br"),a._v("‘08’ :GKD iptali : Rızano ile TCKN uyuşmaması"),e("br"),a._v("‘09’ :GKD iptali : Uygun ürünü bulunmuyor"),e("br"),a._v("‘10’ :GKD iptali : HHS Açık Bankacılık kanalı işleme kapalı"),e("br"),a._v("’11’ :GKD iptali : Hesap Yetki Sorunu"),e("br"),a._v("‘12’ :GKD iptali : ÖHK HHS kontrollerini aşamadı"),e("br"),a._v("‘13’ :GKD iptali : ÖHK isteği ile GKD’den vazgeçildi"),e("br"),a._v("‘14’ :GKD iptali : Fraud Şüphesi"),e("br"),a._v("‘99’ :GKD iptali : Diğer"),e("br")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.PSUInitiated")]),a._v(" "),e("td",[a._v("‘E’ : Evet"),e("br"),a._v("‘H’ : Hayır")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.HHSYOSSrlmKrtr")]),a._v(" "),e("td",[a._v("‘kod’ : Kod,‘unv’ : Unvan")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.SrlmYon")]),a._v(" "),e("td",[a._v("‘A’: Azalan değerle sıralama"),e("br"),a._v("‘Y’: Artan değerle sıralama")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.ZmnAralik")]),a._v(" "),e("td",[a._v("0 : Kayıt Yok "),e("br"),a._v("1 : 0-2 saat"),e("br"),a._v("2 : 2-24 saat"),e("br"),a._v(" 3 : 1-3 gün "),e("br"),a._v(" 4 : 3-15 gün\t"),e("br"),a._v(" 5 : 15 gün ve üstü")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.VarYok")]),a._v(" "),e("td",[a._v("0 : Kayıt Yok "),e("br"),a._v(" 1 : Kayıt Var")])]),a._v(" "),e("tr",[e("td",[a._v("TR.OHVPS.DataCode.HHSDurumu")]),a._v(" "),e("td",[a._v("A : Açık. Üretim Ortamında HHS’nin aktif bir şekilde hizmet vermesi durumu."),e("br"),a._v(" Y : Yaygınlaştırma. Üretim Ortamında HHS’nin kendisi tarafından tanımlanmış kısıtlı ÖHK’ya hizmet vermesi durumu. "),e("br"),a._v("  G : Geçici Hizmet Veremiyor. HHS servislerinde teknik bir sorun olması nedeniyle HHS’nin hizmet verememesi durumu. "),e("br"),a._v("K: Kapalı. HHS’nin hizmet vermeme durumu.")])])])]),a._v(" "),e("h2",{attrs:{id:"ek-3-istemci-sertifikalarının-tanım-ve-yonetimi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-3-istemci-sertifikalarının-tanım-ve-yonetimi"}},[a._v("#")]),a._v(" EK-3: İstemci Sertifikalarının Tanım ve Yönetimi")]),a._v(" "),e("p",[a._v("Tüm katılımcıların BKM API Geçidine erişebilmesi için, BKM tarafından yapılan istemci sertifika doğrulamasından geçmesi gerekmektedir. İstemci sertifikası üretilmeden önce katılımcıların CSR üretme akışını tamamlaması gerekmektedir.")]),a._v(" "),e("p",[a._v("OpenSSL ile CSR (Certificate Signing Request) Oluşturma"),e("br"),a._v("\nAşağıdaki komut ile 2048-bit RSA private key ve CSR oluşturulur."),e("br"),a._v("\nopenssl req -new -newkey rsa:2048 -nodes -keyout PRIVATEKEY.key -out CSR.csr")]),a._v(" "),e("p",[a._v("CSR ile ilgili detay bilgilerin girişinde;"),e("br"),a._v("\nCommon Name (CN) olarak 4 karakterli hhsKod ya da yosKod değeri ile,"),e("br"),a._v("\ndiğer alanlar için de kurum bilgileriniz ile giriş yapılır.")]),a._v(" "),e("p",[a._v("Tüm bilgilerin girilmesinden sonra oluşan private key dosyası kurumunuzda saklanır.\nCSR dosyası ise istemci sertifika üretmek üzere kullanılır. Bu aşamada takip edilmesi gereken adımlar şu şekildedir:")]),a._v(" "),e("p",[a._v('Katılımcıların, TRIP ortamı üzerinden, BKM Tarafından yetki verilmiş kullanıcılarının görebileceği "İstemci Sertifika Talebi" menü adımına giriş yapmaları beklenir. Açılan ekranda,"CSR Dosyası Yükleme" alanı içerisine, katılımcının üretmiş olduğu csr dosyası yüklenir. Yaklaşık 1 dakika içerisinde kuruma özel olarak üretilmiş olan client sertifikası indirilmeye hazır hale gelecektir. "İndir" butonu ile client sertifika indirilir. İstemci tarafında web isteğinin ilgili sertifika ile ilişkilendirilerek oluşturulması gerekmektedir.')]),a._v(" "),e("p",[a._v("Uzun dönemli olarak hazırlanacak olan sertifikalar sertifikasyon ve üretim ortamlarında kullanılacaktır. Sertifikaların işlevselliği ve geçerliliği bu aşamalarda sınanacaktır.")]),a._v(" "),e("p",[a._v("BKM API Geçidi çözümünün test ve üretim ortamları ayrımında istemci sertifikaları, HHS Listeleme API erişimleri ve Sertifikasyon bağlantıları Şekil 15-HHS/YÖS API Mimarisi Diagramında resmedilmiştir.")]),a._v(" "),e("h2",{attrs:{id:"ek-4-sunucu-sertifikaları"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-4-sunucu-sertifikaları"}},[a._v("#")]),a._v(" EK-4: Sunucu Sertifikaları")]),a._v(" "),e("p",[a._v("Sunucu sertifikalarının endpoint bilgisini (Fqdn) içerecek ve global bir Certification Authority tarafından imzalanmış olarak sunulması gerekmektedir.\nÖrneğin; entegrasyon formu içerinde yer alan URL bilgisinin (test.xbank.com.tr) sertifika içerisinde tanımlı olması ve bu sertifikanın global bir CA örneğin Verisign tarafından imzalanmış olarak sunulması gerekmektedir.")]),a._v(" "),e("p",[a._v("Hizmet sağlayıcı olan HHS'ler tarafından sunucu sertifikaları uygulanmalıdır.")]),a._v(" "),e("h2",{attrs:{id:"ek-5-mesaj-imzalama-akısı"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-5-mesaj-imzalama-akısı"}},[a._v("#")]),a._v(" EK-5: Mesaj İmzalama Akışı")]),a._v(" "),e("p",[a._v("Dijital imzalama yapısı, ÖHVPS API’de gerçekleştirilen işlemlerin ve taşınan verilerin bütünlük ve inkâr edilemezliğini sağlamak amacıyla kurgulanmıştır.\nBu kapsamda imzalama akışı aşağıdaki gibi olmalıdır:")]),a._v(" "),e("ul",[e("li",[a._v("HHS ya da YÖS öncelikle özel ve açık anahtarlarını oluşturmalıdır. Bu anahtarları oluşturmak için aşağıda “openssl” kullanılarak oluşturma örneği paylaşılmıştır.  Bu anahtarlardan özel olan anahtar mesajı imzalamak için kullanılacak olup, açık anahtar ise mesajı doğrulamak amacıyla mesajın alıcısı tarafından kullanılacaktır.")])]),a._v(" "),e("p",[a._v("private_key.pem ve public_key.pem dosyasinin içerikleri kod tarafında kullanılacaktır.")]),a._v(" "),e("p",[a._v("--private.pem => Özel anahtarın ismi\nopenssl genrsa -out private.pem 2048")]),a._v(" "),e("p",[a._v("--public_key.pem => Açık anahtarın ismi\nopenssl rsa -in private.pem -pubout -outform PEM -out public_key.pem")]),a._v(" "),e("p",[a._v("--private_key.pem => Özel anahtarın PCKS8 formatına çevrilmesi (Java açısından PCKS8 formatında olma ihtiyacı nedeniyle) openssl pkcs8 -topk8 -inform PEM -in private.pem -out private_key.pem -nocrypt")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Açık ve Özel anahtarlar oluşturulduktan sonra Açık Anahtar BKM ile paylaşılır. BKM bu açık anahtarı diğer katılımcıların ulaşabilmesi ve alabilmesi için bir Anahtar Deposu yaklaşımı ile bünyesinde tutar. İlgili anahtarı iletebilmek ve alabilmek için kullanılacak HHS/YOS API ye erişim detayları EK-6 bölümünde detaylı olarak paylaşılmıştır.  Eğer kurumun ilgili anahtar çiftinin yenilenme durumu söz konusu ise yenilemenin hemen ardından açık anahtar yeni bir imzalama yapılmadan önce mutlaka BKM ile paylaşılmalıdır.")])]),a._v(" "),e("li",[e("p",[a._v("İmzalı mesajı açacak olan kurum mesajı imzalayan kurumun açık anahtarını her sorguda yeniden almak durumunda değildir. Belirli periyodlarda kendi ortamındaki anahtarı yenileyerek sistemi işletebilir. Ancak imzalayan kurum anahtar çifti yenilemesi yaptığında BKM ile açık anahtarını paylaşsa dahi imzalı mesajı doğrulayacak taraf eski açık anahtar ile doğrulama yapmaya çalıştığı için hata alacaktır. Bu ilk hata durumunda hızlıca BKM üzerinden yeni anahtarı alıp mesajı tekrar doğrulamayı denemelidir. Eğer yine hata alıyor ise doğrulama işlemini hata statüsüne almalıdır. Bu sebeple anahtar yenileyen kurum yeni açık anahtarını yeni bir mesaj imzalama yapmadan önce mutlaka BKM ile paylaşmalıdır.")])]),a._v(" "),e("li",[e("p",[a._v("PSU-Fraud-Check alanı için de JWT formatında çıktı hazırlanması beklenmektedir. Örnek bir PSU-Fraud-Check payload değeri aşağıdaki gibidir;")]),a._v(" "),e("p",[a._v('{"AnomalyFlag": "0",'),e("br"),a._v('\n"LastPasswordChangeFlag": "1",'),e("br"),a._v('\n"FirstLoginFlag": "1",'),e("br"),a._v('\n"DeviceFirstLoginFlag": "1",'),e("br"),a._v('\n"BlacklistFlag": "0",'),e("br"),a._v('\n"MalwareFlag": "0",'),e("br"),a._v('\n"UnsafeAccountFlag": "0",'),e("br"),a._v('\n"exp": 1663424479,'),e("br"),a._v('\n"iat": 1663338079,'),e("br"),a._v('\n"iss": "[https://apigw.bkm.com.tr|https://apigw.bkm.com.tr/]" }')])])]),a._v(" "),e("h3",{attrs:{id:"imzalama-kuralları-yos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#imzalama-kuralları-yos"}},[a._v("#")]),a._v(" İmzalama Kuralları (YÖS)")]),a._v(" "),e("p",[a._v("Bir YÖS üzerinden başlayan akış örnek olarak paylaşılmıştır.")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("YÖS, mesaj imzalama gerektiren her API isteğinin HTTP gövdesini (request body) kendi özel anahtarı ile şifreleyerek imza bilgisini oluşturur.")])]),a._v(" "),e("li",[e("p",[a._v("Ardından bu imza verisini, göndereceği mesajın istek başlığında yer alan X-JWS-Signature alanında göndermelidir.")])]),a._v(" "),e("li",[e("p",[a._v("X-JWS-Signature alanında gönderilecek olan bilgi aşağıdaki yöntem ile oluşturulmalıdır.")]),a._v(" "),e("ol",[e("li",[e("p",[a._v("Bu alana yazılacak olan bilgi JWT formatında oluşturulmalıdır.")])]),a._v(" "),e("li",[e("p",[a._v("Bir JWT, header-payload-signature alanlarından oluşmaktadır.")]),a._v(" "),e("ul",[e("li",[a._v("Header alanında JWT’yi imzalamak için kullanılacak algoritma belirtilmelidir.  Standartlar kapsamında RS256 kullanılacaktır.")]),a._v(" "),e("li",[a._v("Payload kısmında özel olarak oluşturulacak olan “body” claim alanına istek gövdesi (request body) verisinin SHA256 hash değeri karşılığı yazılmalıdır.")]),a._v(" "),e("li",[a._v('JSON payload oluşturulurken RFC 7519 baz alınmalıdır. "iss" (Issuer) Claim, "exp" (Expiration Time) Claim, "iat" (Issued At) Claim, “body” Claim alanlarının gönderilmesi zorunludur.'),e("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-4",target:"_blank",rel:"noopener noreferrer"}},[a._v("^RFC7519"),e("OutboundLink")],1),e("br"),a._v('\na.\t"iss" (Issuer) Claim : Kurumunuza özel bilgidir.'),e("br"),a._v('\nb.\t"exp" (Expiration Time) Claim: Saniye cinsinden (Unix time) imzanın son geçerli olduğu tarih. Bu tarih  mevcut sunucu saatinizden 60 dakika sonra olacak şekilde kullanılmalıdır.'),e("br"),a._v('\nc.\t"iat" (Issued At) Claim : Saniye cinsinden (Unix time) imzanın oluşturulduğu tarih. Bu tarih  mevcut sunucu saatinizden 5 dakika önce olacak şekilde kullanılmalıdır.'),e("br"),a._v("\nd.\t“body” Claim : istek gövdesi (request body) verisinin SHA256 hash değeri karşılığı.")]),a._v(" "),e("li",[a._v("Signature alanında da özel anahtar ile imzalanmış olan imza içeriği yer alacaktır.")])]),a._v(" "),e("p",[e("strong",[a._v("X-JWS-Signature:")]),a._v("  JWS imzasını içeren üstbilgi. Bu başlığın ne zaman belirtilmesi gerektiği hususu ilgili endpoint için belirtilmiştir.")]),a._v(" "),e("p",[e("strong",[a._v("Örnek X-JWS-Signature Payload Değeri")])]),a._v(" "),e("p",[a._v("{"),e("br"),a._v('\n"iss": "https://apigw.bkm.com.tr",'),e("br"),a._v('\n"exp": 1646832405,'),e("br"),a._v('\n"iat": 1646746005,'),e("br"),a._v('\n"body": "c543072f97a761a1d891dc81acc380bc1e6f61ca6541bd93ebfdece338457922"'),e("br"),a._v("\n}")])])])]),a._v(" "),e("li",[e("p",[a._v("YÖS, isteği gönderir. Sadece mesajın bütünlüğünü ve doğruluğunu teyit amacı ile istek gövdesi (request body) SHA256 hash değeri imzalanarak X-JWS-Signature alanında bu imza iletilir. İsteğin gövde (request body) kısmı açık ve şifresiz olarak gönderilmektedir.")])]),a._v(" "),e("li",[e("p",[a._v("HHS, isteği alır, talebi gerçekleştirmeden önce aldığı API isteklerinin imzasını doğrulamalıdır. X-JWS-Signature alanındaki JWT aşağıdaki adımlarla doğrulanmalıdır.")]),a._v(" "),e("ol",[e("li",[a._v("Header kısmındaki algoritmanin RS256 olduğu kontrol edilir.")]),a._v(" "),e("li",[a._v("Gönderen kurumun açık anahtarı ile JWT verify (doğrulama) işlemi yapılır.")]),a._v(" "),e("li",[a._v("Yukarıdaki işlemlerin doğruluğunun ardından JWT’nin payload kısmındaki “body” claim alanındaki bilginin, isteğin gövde verisinin SHA256 hash değerlerinin aynı olduğu kontrol edilir.")]),a._v(" "),e("li",[a._v("Örnek checksum değeri "),e("br"),a._v(' "a64b19f95eeb1fb0a0a3e2dbbc6e3d8472c52184d4543417ddc6d156fc5c5571" veya '),e("br"),a._v(' "A64B19F95EEB1FB0A0A3E2DBBC6E3D8472C52184D4543417DDC6D156FC5C5571" şeklinde olabilir. İki hali de aynı değere sahiptir. Kontrollerde buna dikkat edilmesi gerekmektedir.')])])]),a._v(" "),e("li",[e("p",[a._v("Yukarıdaki işlemler ile doğruluğu teyit edilmiş olan isteğin talebi gerçekleştirir.")])]),a._v(" "),e("li",[e("p",[a._v("Eğer istek doğrulanamıyor ise gönderen kurumun açık ve özel anahtar çifti yenilenmiş olabilir.")])]),a._v(" "),e("li",[e("p",[a._v("BKM HHS API  üzerinden ilgili kurumun bilgilerini (kurum kodu vs) kullanarak kurumun detay bilgileri çeker ve kendi ortamında yeniler.")])]),a._v(" "),e("li",[e("p",[a._v("Ardından imzayı tekrar açık anahtar ile doğrulayarak kontroller gerçekleştirilir. (Eğer halen doğrulama işlemi başarısız ise bu istek için hata akışı çalıştırılır. "),e("strong",[a._v("TR.OHVPS.Resource.InvalidSignature")]),a._v(" kodu ile hata üretilebilir.)")])]),a._v(" "),e("li",[e("p",[a._v("İmza bilgisinin beklendiği (x-jws-signature) servislerde, bu bilginin iletilmediği durumlarda "),e("strong",[a._v("TR.OHVPS.Resource.MissingSignature")]),a._v(" hatası üretilebilir.")])]),a._v(" "),e("li",[e("p",[a._v("HHS isteği işledikten sonra cevabı oluştururken de yukarıdaki akışlar ile göndereceği cevabı imzalamalıdır.")])]),a._v(" "),e("li",[e("p",[a._v('İstek yanıt gövdesinin SHA256 checksum değeri için hexadecimal çıktı kullanılacaktır. Oluşacak çıktının 64 karakter olması beklenmektedir. Kontrol için "^[A-Fa-f0-9]{64}$" RegEx tarifini kullanabilirsiniz.')])])]),a._v(" "),e("p",[a._v("Örnek bir gövde:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('{"katilimciBlg":{"hhsKod":"8000","yosKod":"8000"},"gkd":{"yetYntm":"Y","yonAdr":"https://boss-test.bkm.com.tr/boss/ab/yosSimulator/8000?drmKod=6021de9f-55e7-454a-94be-2044866b22e1"},"kmlk":{"kmlkTur":"M","kmlkVrs":"123456","ohkTur":"B"},"hspBlg":{"iznBlg":{"iznTur":["01","02","03","04","05"],"erisimIzniSonTrh":"2022-10-12T23:59:59+03:00","hesapIslemBslZmn":"2021-10-10T00:00:00+03:00","hesapIslemBtsZmn":"2023-10-10T23:59:59+03:00"}}}\n')])])]),e("p",[a._v("Bu gövdenin checksum'ı:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("a64b19f95eeb1fb0a0a3e2dbbc6e3d8472c52184d4543417ddc6d156fc5c5571\n")])])]),e("p",[a._v("Bu checksum'ın iletildiği x-jws-signature başlık değeri:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczovL2FwaWd3LmJrbS5jb20udHIiLCJleHAiOjE2NjU0NzU1NjIsImlhdCI6MTY2NTM4OTE2MiwiYm9keSI6ImE2NGIxOWY5NWVlYjFmYjBhMGEzZTJkYmJjNmUzZDg0NzJjNTIxODRkNDU0MzQxN2RkYzZkMTU2ZmM1YzU1NzEifQ.Q65PI_1fTEzzBMirvmJvXgVX3orhhZ4_UqujtGdHkU7me-1ymIjvPrzy3kfyER1pedFb7HDCBuPvYoqjX8eUnpiiZsxfzCiEa0McIhoFeUOggq-O8VihItp8bLr2DWwQ9JHN1-WXB2mL31KAKFAL1VY9-DXuAdT-RfE_SLYsl2ycmNy4ti4XvfDvvlE56ZsieFZ727VuwR8wi7F0kKDc6UhjaMF9xcUeAM1fxX-bmcOaOo1NZGC0vvgjNZKz_OJrN-q8VhWYnQPiJ7wY7S9IG8bHIkBImKSVf8LuOEvl8u0BZzADLH1iOBd9x2l1plyI_NLPTrnOqhWhKlljkkJBCg\n")])])]),e("p",[a._v("Eğer PSU-Fraud-Check için başlık gönderilecekse, yine JWT formatında imza üretilmelidir. Örnek bir psu-fraud-check başlık değeri:")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("eyJhbGciOiJSUzI1NiJ9.eyJBbm9tYWx5RmxhZyI6IjAiLCJMYXN0UGFzc3dvcmRDaGFuZ2VGbGFnIjoiMSIsIkZpcnN0TG9naW5GbGFnIjoiMSIsIkRldmljZUZpcnN0TG9naW5GbGFnIjoiMSIsIkJsYWNrbGlzdEZsYWciOiIwIiwiTWFsd2FyZUZsYWciOiIwIiwiVW5zYWZlQWNjb3VudEZsYWciOiIwIiwiZXhwIjoxNjY1NDc1NTU2LCJpYXQiOjE2NjUzODkxNTYsImlzcyI6Imh0dHBzOi8vYXBpZ3cuYmttLmNvbS50ciJ9.DhUh_nsXDuNIrvsQ3KOhOXdVcJg6fTDVW8K1oea8kLtmb7n-_hJHY3mWX5zzobu-Vh2VvFzIxPhHtol6gLHFktmIMiQ9TDHb_mRZFXgJB4ToNfqc3Fy9mi5bS8By2IYi1HxDaCStstaZDaunzXfHCtqybfZXyk6teDrf-iIf6lqX9Keo7GZO-Y7mP7C13-c_QwyNKrZK4TZwUQbecRqXYn1DcEHM7kukQHTar_hKBWkXPmNpScY0J2rKksr4ejR1uLhdQm-Pdwoe9y6qrNEB79vMLBkRNtbuV0vc1GYHp_YKkzBKBI_58uuB2GD9877CsrcRnHMQb88xpxiPKh6-ew\n")])])]),e("h2",{attrs:{id:"ek-6-hhs-yos-api-mimarisi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ek-6-hhs-yos-api-mimarisi"}},[a._v("#")]),a._v(" EK-6: HHS/YÖS API Mimarisi")]),a._v(" "),e("p",[a._v("HHS/YÖS API Uygulama Mimarisinde Test ve Üretim ortamlarında aşağıdaki alanda yer almaktadır.")]),a._v(" "),e("img",{attrs:{src:i(546),width:"50%"}}),a._v(" "),e("p",[a._v("Şekil 15: HHS/YÖS API Mimarisi")])])}),[],!1,null,null,null);e.default=l.exports}}]);